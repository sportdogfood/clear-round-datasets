{
  "file": "expeditor-contract.json",
  "version": "v2025-12-18-expeditor-03",
  "street": "blog",
  "house": "cp:2",
  "role": "exp",
  "purpose": [
    "Shape raw datasets into lane-safe, schema-stable inputs",
    "Normalize null and empty values deterministically",
    "Route data into numbered input bins required by job_definition.run_order",
    "Produce NO narrative and NO inference"
  ],
  "global_constraints": {
    "no_prose": true,
    "no_inference": true,
    "no_external_lookup": true,
    "no_cross_lane_data": true,
    "input_is_authoritative": true,
    "schema_is_fixed": true,
    "empty_is_safer_than_guessing": true
  },
  "normalization_rules": {
    "string_fields": {
      "null": "could-not-verify",
      "empty_string": "could-not-verify",
      "whitespace_only": "could-not-verify"
    },
    "numeric_fields": {
      "invalid": null
    },
    "arrays": {
      "missing": [],
      "null": []
    },
    "objects": {
      "missing": {}
    }
  },
  "inputs": {
    "job_definition": {
      "required": true,
      "read_only": true,
      "required_fields": ["job_id", "shape", "street", "house", "run_order", "datasets", "global_rules"]
    },
    "datasets_by_role": {
      "required": true,
      "read_only": true,
      "rule": "Must contain every dataset role_key declared in job_definition.datasets"
    }
  },
  "dataset_families": {
    "C": {
      "domains_all": ["event", "venue", "city_season"]
    },
    "P": {
      "domains_all": ["stay", "dine", "essentials", "locale"]
    }
  },
  "dataset_binding_rules": {
    "binding_mode": "family_ordered_by_job_definition_datasets",
    "c_pass_n_binds_to": "nth dataset (1-indexed) in family C",
    "p_pass_n_binds_to": "nth dataset (1-indexed) in family P",
    "pass_requirement_source": "job_definition.run_order",
    "on_missing_dataset_for_required_pass": {
      "action": "halt",
      "error_code": "EXP_MISSING_DATASET_FOR_PASS"
    }
  },
  "output_bins": {
    "c_in_n": {
      "role": "collection_researcher",
      "domains": ["event", "venue", "city_season"],
      "bin_name_pattern": "c_in_{n}",
      "shape": {
        "creation_id": "string",
        "job_id": "string",
        "shape": "string",
        "street": "string",
        "house": "string",
        "pass_n": "number",
        "dataset_role_key": "string",
        "event_identity": "object",
        "event_rows": "array",
        "venue_rows": "array",
        "city_season_rows": "array",
        "source_log": "array"
      }
    },
    "p_in_n": {
      "role": "places_researcher",
      "domains": ["stay", "dine", "essentials", "locale"],
      "bin_name_pattern": "p_in_{n}",
      "shape": {
        "creation_id": "string",
        "job_id": "string",
        "shape": "string",
        "street": "string",
        "house": "string",
        "pass_n": "number",
        "dataset_role_key": "string",
        "stay": { "feature": "array", "list_only": "array" },
        "dine": { "feature": "array", "list_only": "array" },
        "essentials": { "feature": "array", "list_only": "array" },
        "locale": { "rows": "array" },
        "source_log": "array"
      }
    }
  },
  "lane_isolation": {
    "collection_domains": ["event", "venue", "city_season"],
    "places_domains": ["stay", "dine", "essentials", "locale"],
    "rules": [
      "collection data MUST NOT appear in places bins",
      "places data MUST NOT appear in collection bins",
      "locale data MUST NOT be expanded beyond provided rows"
    ]
  },
  "forbidden_behaviors": [
    "adding derived fields",
    "renaming keys",
    "dropping required keys",
    "creating prose or summaries",
    "repairing data semantically",
    "guessing missing values",
    "merging domains"
  ],
  "error_handling": {
    "missing_required_dataset": { "action": "halt", "error_code": "EXP_MISSING_DATASET" },
    "missing_dataset_for_required_pass": { "action": "halt", "error_code": "EXP_MISSING_DATASET_FOR_PASS" },
    "schema_violation": { "action": "halt", "error_code": "EXP_SCHEMA_VIOLATION" },
    "unexpected_domain": { "action": "halt", "error_code": "EXP_UNEXPECTED_DOMAIN" }
  },
  "logging": {
    "emit_source_log": true,
    "include_row_counts": true,
    "include_domain_coverage": true,
    "include_bound_pass_to_dataset_role_key": true
  },
  "guarantees": [
    "All downstream lanes receive schema-stable inputs",
    "All missing values are explicitly normalized",
    "No lane receives data it is not contractually allowed to see",
    "Failure is explicit and early"
  ]
}
