# File: items/blog/cp-2/instructions.txt
# Runner: blog-cp:2 — HOUSE CONTRACT
# Version: v2025-12-15-house-04
# Updated: 2025-12-15T22:10Z

============================================================
0. PURPOSE (STRICT)
============================================================

This file defines the **behavioral contract** for the BLOG cp:2 house.

It describes:
- lane responsibilities,
- allowed inputs and outputs,
- enforcement rules,
- validation points.

It does NOT:
- execute logic,
- infer behavior,
- override job_definition,
- redefine schemas declared elsewhere.

This file MUST remain consistent with:
- SYSTEM-SPINE.md
- instructions-mini.txt (V2)
- pipeline-spec.json
- commit-spec.json
- job_definition stored in Rows

============================================================
1. TRIGGER AND MODE
============================================================

Accepted trigger:

- start blog-cp:2

No arguments.
No variants.
On any other input: do nothing.

Execution mode is determined solely by:

- job_definition.mode

Allowed value:
- "live"

Rules:
- If job_definition.mode != "live":
  - NO lanes execute
  - NO commits occur
  - Respond with ONE error:
    "blog-cp:2 requires job_definition.mode == 'live'"

============================================================
2. JOB DEFINITION (AUTHORITATIVE)
============================================================

job_definition is loaded from Rows using trigger key:

- "blog-cp:2"

The following fields are REQUIRED:

- job_id        : string
- street        : "blog"
- house         : "cp:2"
- run_order     : non-empty array
- global_rules  : object
- datasets      : non-empty array
- paths         : object containing:
    - docs_finals_root (starts with "docs/")
    - docs_logs_root   (starts with "docs/")

Rules:
- job_definition is authoritative.
- House files MUST NOT override:
  - run_order
  - global_rules
  - datasets
  - paths
- Any violation is a hard failure.

============================================================
3. HOUSE FILES (REQUIRED)
============================================================

House root:

- items/blog/cp-2/

The following files MUST exist:

- instructions-mini.txt
- instructions.txt
- pipeline-spec.json
- commit-spec.json
- final-schema.json

Lane prompts:
- member-template-cr-prompt.txt
- member-template-cw-prompt.txt
- member-template-pr-prompt.txt
- member-template-pw-prompt.txt
- member-template-rwt-prompt.txt

If ANY required file is missing:
- STOP
- Return ONE error:
  "cp:2 house misconfigured: missing {filename}"

============================================================
4. DATASETS (DECLARATIVE ONLY)
============================================================

Datasets are declared ONLY in job_definition.datasets.

Each dataset entry MUST contain:
- role_key
- sheet_id
- table_id
- range

Rules:
- The house does NOT assume meaning from role_key names.
- No implicit role-to-lane mapping exists outside expeditor.
- Datasets are passed raw to expeditor.

============================================================
5. PIPELINE EXECUTION MODEL
============================================================

Execution order is EXACTLY:

- job_definition.run_order

The house defines NO default order.

Each lane:
- runs once,
- in sequence,
- in memory,
- using only declared inputs.

No lane may:
- access Rows,
- access Docs,
- call tools,
- browse,
- read other lanes’ outputs unless explicitly passed.

============================================================
6. LANE CONTRACTS (CANONICAL)
============================================================

---------------------------------
6.1 exp — Expeditor
---------------------------------

Role:
- The ONLY shaping lane.

Inputs:
- job_definition
- datasets_by_role
- global_rules
- expeditor-contract.json

Outputs:
- Structured lane inputs only.

Rules:
- Normalize empty values → "could-not-verify"
- Enforce declared schemas
- NO prose
- NO inference
- NO enrichment

---------------------------------
6.2 cr — Collection Researcher
---------------------------------

Role:
- Facts-only research for:
  - event
  - venue
  - city_season

Inputs:
- exp-produced CR input
- global_rules
- member-template-cr-prompt.txt

Output:
- collection-research-bin

Rules:
- No narrative
- No external research
- No schema mutation

---------------------------------
6.3 cw — Collection Writer
---------------------------------

Role:
- Narrative transformation ONLY.

Inputs:
- collection-research-bin
- event_identity
- global_rules

Output:
- collection-writer-bin

Rules:
- Exactly two paragraphs
- No facts added
- No lists
- No schema changes

---------------------------------
6.4 pr — Places Researcher
---------------------------------

Role:
- Facts-only research for Places lanes:
  - stay
  - dine
  - essentials
  - locale

Inputs:
- exp-produced PR input
- global_rules
- member-template-pr-prompt.txt

Output:
- places-research-bin

Rules:
- Locale may contain facts
- Other lanes may be empty or sentinel-only
- No narrative
- No enrichment

---------------------------------
6.5 pw — Places Writer
---------------------------------

Role:
- Narrative transformation ONLY.

Inputs:
- places-research-bin
- expeditor-curated place rows
- global_rules

Output:
- places-writer-bin

Rules:
- Lane-symmetric output:
  - stay, dine, essentials, locale
- Generic prose allowed when research is empty
- No invention
- No cross-lane borrowing

---------------------------------
6.6 rwt — Rewriter
---------------------------------

Role:
- Text hygiene pass ONLY.

Inputs:
- collection-writer-bin
- places-writer-bin

Output:
- rewritten-writer-bin

Rules:
- Structure preserved exactly
- Non-string values untouched
- Prose cleaned only
- No new facts
- ASCII only

============================================================
7. FINAL ASSEMBLY AND VALIDATION
============================================================

Assembly:
- rewritten-writer-bin is validated against final-schema.json

Validation failures:
- STOP execution
- Write log
- Return ONE error:
  "final schema validation failure"

checker.json:
- Applied after rewrite
- Errors are fatal
- Warnings are logged only

============================================================
8. COMMIT AND USER RESPONSE
============================================================

Commits are driven solely by:
- commit-spec.json
- job_definition.paths

Artifacts committed:
- final JSON
- final HTML (deterministic render)
- run log JSON

On success:
- Return ONE message with:
  - job_id
  - run_order
  - paths
  - commit SHA (if available)

On failure:
- ONE error message
- Name failing phase ONLY

============================================================
END OF FILE
============================================================
