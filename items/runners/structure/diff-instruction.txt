# items/runners/structure/diff-instruction.txt
# Lines removed from instruction.txt to produce runner-instruction.txt

- Purpose: Structure Runner builds/updates the static blog under /docs/blogs/. It never edits post body JSON contents.
- TRIGGER (message JSON)
-   "rebuild_all": true|false,                    // optional mode
- NETWORK RULES
- - Do not fetch any other domains.
- PATHS & SLUGS
- - The JSON filename is kept verbatim inside the slug folder.
- INPUT SHAPES (post JSON)
- - Paragraph fields allowed Markdown inline links in text only:
-   hello.intro, hello.outro, stay.paragraph, dine.am, dine.dinner, locale.paragraph, essentials.paragraph
- IMAGES (desc-images.json)
- - Slots on single post page: hero, stay, dine, essentials, locale.
- MANIFEST (docs/blogs/manifest.json)
- - If discipline empty, omit discipline field. If no rating data in post, omit sanctioning/fei_level/usef_premier.
- PAGE GENERATION (HTML)
- 1) Single post (blog.index.html.tmpl)
-    - SEO precedence: post.seo.section_title → open_graph_title; description = meta_description → open_graph_description.
-    - Tags: from manifest entry for this slug.
- 2) Listing page (blogs.index.html.tmpl) → docs/blogs/index.html
-    - “Recent” rail: newest 4 by date.
- 3) Year archive (year.index.html.tmpl) → docs/blogs/{year}/index.html
-    - Header shows {year}. Provide “All blogs” + Season chips that filter within the year.
- 4) RSS (rss.xml.tmpl) → docs/blogs/rss.xml
-    - Each item uses manifest.title, link = {canonical_base}{manifest.path}, pubDate = date.
- 5) Sitemap (sitemap.xml.tmpl) → docs/sitemap.xml
- TEMPLATES
- - Use the installed templates at items/runners/structure/templates/*.tmpl
- - Do not inline timestamps. Outputs must be deterministic/idempotent.
- VALIDATION
- - If section_link provided, fetch and parse for SEO fallback only when post.seo missing.
- - All links you emit must be site-root absolute for internal pages and http(s) for external.
- IDEMPOTENCE & ORDERING
- - Sort manifest by date desc only for interactive needs; keep stored as an array with upserts by slug.
- - Neighbors determined from date desc sorted snapshot.
- - Do not mutate post JSON content other than verbatim write-through.
- OUTPUTS ON remove_post
- - Rebuild index.html, {year}/index.html (if year now empty, still emit the page with empty state), rss.xml, sitemap.xml
- COMMIT (single bulk operation)
- - Prepare an array:
-   files[] = { path:"docs/…", content_type:"text/html|application/xml|application/json", content_base64:"…" }
- - Call action crt_bulk_commit (POST /docs/commit-bulk)
-   { "message": "chore: add_post {slug}", "overwrite": true, "files": [ … ] }
- ERROR BEHAVIOR
- - If manifest write would produce invalid JSON: do not commit; return trace.
- CONSTRAINTS
- - No non-HTTPS.
- - No unlisted domains beyond allow_urls.
- DEFAULTS (mirror policy.json)
- - placeholders exist under /docs/assets/images/: hero-placeholder.jpg, stay-placeholder.jpg, dine-placeholder.jpg, place-placeholder.jpg, card-placeholder.jpg (used only in listings/cards when manifest.image absent).
