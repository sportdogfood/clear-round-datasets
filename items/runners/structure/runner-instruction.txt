# items/runners/structure/runner-instruction.txt  (short, <8000 chars)

Purpose
- Build/update static blog under /docs/blogs/. Never edit post body JSON.

Trigger JSON
{
  "add_post": "<RAW GitHub JSON URL>",          // or
  "remove_post": "<slug>",                       // or
  "rebuild_all": true,
  "canonical_base": "https://blog.clearroundtravel.com",
  "images_link": "<RAW desc-images.json>",       // optional
  "section_link": "<RAW section SEO JSON>",      // optional
  "allow_urls": ["https://…"]                    // every remote you will fetch
}

Network
- HTTPS only. Fetch only add_post, images_link, section_link, and allow_urls.
- Retry x2, timeout 5s.

Paths & Slugs
- docs/blogs/{venue}-blogs-{year}/{slug}/
- slug: {venue}-blog-{YYYY-MM-DD} from filename.
- Keep JSON filename verbatim in the slug folder.
- Public links start with /blogs/…

Post JSON Inputs
- Use *.link fields (not *.url).
- Markdown links allowed only inside paragraph-like fields (intro/outro/stay/dine/locale/essentials).
- Use post.seo if present; otherwise fallback to section_link SEO if provided.

Images (desc-images.json)
- Keys: hero_*, stay_*, dine_*, essentials_*, locale_*, card_*, image_alt_text.
- If *_hidden==1 → don’t render that slot. Else use *_image_link if set. No global fallback.
- Single-page slots: hero/stay/dine/essentials/locale.
- card_image_link → manifest.image only.

Manifest (docs/blogs/manifest.json)
- Array; upsert by slug.
- On add_post, set:
  slug, title, date, year, month_num, month_name, season,
  path, json, image, venue, city, state, country,
  tags[], sanctioning, fei_level, usef_premier, discipline[]
- title: section_title → open_graph_title → post.title → slug
- image: from card_image_link if provided
- path: /blogs/{venue}-blogs-{year}/{slug}/
- json: /blogs/{venue}-blogs-{year}/{slug}/{post-json-filename}
- Omit empty rating/discipline fields.
- On remove_post: delete manifest entry.

Pages
1) Single Post → docs/blogs/{venue}-blogs-{year}/{slug}/index.html
   - Canonical: {canonical_base}{manifest.path}
   - Escape text; convert [label](https://…) to safe <a> (target=_blank rel=noopener).
   - Lists from items[].name + link (+ “ — {alt}” if present).
   - Tag chips from manifest.
   - Prev/next by date (desc).

2) Listing → docs/blogs/index.html
   - Left: Home, Year links (from manifest), Season rollups (only if entries exist).
   - Click Year OR Season: hide non-relevant cards (don’t remove).
   - Season carousels: “{Season}   see all >” + horizontal cards (image/title/date/venue or city).
   - Use manifest.image; if missing → /docs/assets/images/card-placeholder.jpg
   - “Recent” rail: newest 4.

3) Year Archive → docs/blogs/{year}/index.html
   - Date-desc grid/list; card placeholder when no manifest.image.
   - Header shows {year}; chips for seasons filter within the year.

4) RSS → docs/blogs/rss.xml
   - Newest first, limit defaults.rss_item_limit (20).

5) Sitemap → docs/sitemap.xml
   - Include /blogs/, /blogs/{year}/, and each manifest.path.

Validation
- add_post must fetch 200 JSON.
- images_link optional; if missing, treat all slots hidden.
- section_link optional; used only when post.seo missing.
- All internal links site-root (/blogs/…); external http(s) only.
- manifest.json must remain a valid JSON array.

Idempotence
- Upsert manifest by slug; neighbors from date-desc snapshot.
- Never mutate post JSON (write-through only).

Outputs on add_post
- docs/blogs/{venue}-blogs-{year}/{slug}/index.html
- docs/blogs/{venue}-blogs-{year}/{slug}/{post-json-filename}.json  (verbatim copy)
- docs/blogs/manifest.json
- docs/blogs/index.html
- docs/blogs/{year}/index.html
- docs/blogs/rss.xml
- docs/sitemap.xml

Outputs on remove_post
- Delete the slug folder.
- Update manifest; rebuild listing/year/rss/sitemap (year page may be empty-state).

Commit (single bulk)
- files[] = { path:"docs/…", content_type:"text/html|application/xml|application/json", content_base64:"…" }
- POST /docs/commit-bulk with overwrite=true
- Return: { writes[], deletes[], trace[], commit{ sha,url } }

Defaults (from policy.json)
- canonical_base=https://blog.clearroundtravel.com
- recent_count=4
- rss_item_limit=20
- Placeholders under /docs/assets/images/: hero-placeholder.jpg, stay-placeholder.jpg, dine-placeholder.jpg, place-placeholder.jpg, card-placeholder.jpg
