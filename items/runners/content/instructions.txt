TITLE: Content Runner — Deterministic content + SR trigger
Version: 2025-10-16.CR-v1
Purpose: Single URL → GET task → fetch items/* → generate content package → write SR trigger → stop. No mirrors. No SR calls.

INPUT
- One payload: {"task_uri":"https://items.clearroundtravel.com/items/tasks/{slug}-task-YYYY-MM-DD.json"}

LOAD
- policy.json: https://items.clearroundtravel.com/items/runners/content/policy.json
- task.schema.json: https://items.clearroundtravel.com/items/runners/content/task.schema.json
- generator.rules.json: https://items.clearroundtravel.com/items/runners/content/generator.rules.json

FETCH POLICY
- Only GET https://items.clearroundtravel.com/items/** found in task fields ending *_link or *_links[].
- External links (event_official_link, venue_official_link) are display-only. Never fetch.

TRACE (path,status; collapse successes; max 18)
task_uri, policy, schema, rules, audiences, venue, event, geo, section, stay, dine, essentials, patterns, outros, ctas, libs_bundle, content_write, trigger_write

WORKFLOW
1) GET policy, schema, rules (trace).
2) GET task_uri. Fail-close on non-200.
3) Normalize types: coerce CSV *_links → arrays; parse booleans and integers.
4) Build ALLOW_URLS from *_link and *_links[]; enforce items/* only.
5) GET required items: event_link, venue_link, geo_link, section_link; then optional libs if present.
6) Build context for generator: {event, venue, geo, section, libs, curated, externals, knobs, flags}.
7) Call generator (pure): returns {sections, seo, metrics}. Generator enforces all prose rules from generator.rules.json.
8) Assemble content package: {manifest, sections, provenance, quality, validation}.
9) Validate IO gates (policy): UTF-8, min-bytes, path regex, absolute http(s) images, arrays minima. Fail-close on miss.
10) Commit content package to output_path (default: items/content/{slug}-content-{YYYY-MM-DD}.json) via /items/commit-bulk. Verify by GET.
11) Commit SR trigger to items/triggers/{slug}-trigger-{YYYY-MM-DD}.json with fields: content_link, year, post_folder_slug, commit_message, event_link?, images_link?.
12) Stop. Do not call SR.

DERIVATIONS
- slug = task_uid without “-task-YYYY-MM-DD”
- base_date = from task_uid or output_path
- year = YYYY from base_date
- post_folder_slug = {slug}-content-{base_date}
- Default output_path = items/content/{slug}-content-{base_date}.json

OUTPUTS
- Content package JSON → items/content/{slug}-content-{base_date}.json
- SR trigger JSON → items/triggers/{slug}-trigger-{base_date}.json
- Both via /items/commit-bulk (see openapi.txt)

NOTES
- No canvas emit. No docs writes from CR. All quality rules live in generator.rules.json.
