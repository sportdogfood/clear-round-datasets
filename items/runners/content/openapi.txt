openapi: 3.1.0
info:
  title: CRT Runner-Light API
  version: "1.2.4"
  description: "Minimal surface for runner reads and writes to items/ and docs/."
servers:
  - url: https://items.clearroundtravel.com

paths:
  /health:
    get:
      operationId: health
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            text/plain:
              schema:
                type: string
                example: OK

  /items/{path}:
    get:
      operationId: items_get
      summary: Read a file from items/
      description: Returns raw file contents under items/.
      parameters:
        - in: path
          name: path
          required: true
          description: "Path relative to items/, e.g. triggers/example.json"
          schema:
            type: string
      responses:
        "200":
          description: Raw file contents
          content:
            text/plain:
              schema:
                type: string
        "404":
          description: Not found
        "500":
          description: Server error

  /docs/{path}:
    get:
      operationId: docs_get
      summary: Read a file from docs/
      description: Returns raw file contents under docs/.
      parameters:
        - in: path
          name: path
          required: true
          description: "Path relative to docs/, e.g. blogs/2025/index.html"
          schema:
            type: string
      responses:
        "200":
          description: Raw file contents
          content:
            text/plain:
              schema:
                type: string
        "404":
          description: Not found
        "500":
          description: Server error

  /docs/commit-bulk:
    post:
      operationId: docs_commit_bulk
      summary: Bulk commit docs/* files
      description: Creates a single commit writing explicit files under docs/.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/BulkCommitRequest"
      responses:
        "200":
          description: Commit result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CommitResponse"
        "400":
          description: Bad request
        "500":
          description: Server/GitHub error

  /items/commit-bulk:
    post:
      operationId: items_commit_bulk
      summary: Bulk commit items/* files
      description: Creates a single commit writing explicit files under items/.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemsBulkCommitRequest"
      responses:
        "200":
          description: Commit result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CommitResponse"
        "400":
          description: Bad request
        "500":
          description: Server/GitHub error

components:
  schemas:
    FileItem:
      type: object
      required: [path, content_base64]
      properties:
        path:
          type: string
          description: "Destination path. Must start with docs/ and end with .html | .xml | .json."
          pattern: '^docs/.+\.(html|xml|json)$'
          example: "docs/blogs/2025/example/index.html"
        content_type:
          type: string
          description: MIME type hint (optional)
          enum: [text/html, application/json, application/xml]
        content_base64:
          type: string
          description: "Base64 of file bytes (no data: prefix)."
    BulkCommitRequest:
      type: object
      required: [files]
      properties:
        message:
          type: string
          description: Commit message
          example: "publish example slug"
        overwrite:
          type: boolean
          description: Force update the branch ref
          default: true
        files:
          type: array
          minItems: 1
          description: Explicit files to write under docs/
          items:
            $ref: "#/components/schemas/FileItem"

    ItemsFileItem:
      type: object
      required: [path, content_base64]
      properties:
        path:
          type: string
          description: "Destination path. Must start with items/ and have an allowed extension."
          pattern: '^items/.+\.(json|txt|csv|ndjson|md|tmpl)$'
          example: "items/triggers/example.json"
        content_type:
          type: string
          description: Optional MIME hint
        content_base64:
          type: string
          description: "Base64 of file bytes (no data: prefix)."
    ItemsBulkCommitRequest:
      type: object
      required: [files]
      properties:
        message:
          type: string
          example: "update seeds and triggers"
        overwrite:
          type: boolean
          default: true
        files:
          type: array
          minItems: 1
          description: Explicit files to write under items/
          items:
            $ref: "#/components/schemas/ItemsFileItem"

    CommitResponse:
      type: object
      properties:
        ok:
          type: boolean
          example: true
        commit:
          type: object
          properties:
            sha:
              type: string
              example: "abc123def456"
            url:
              type: string
              format: uri
              example: "https://github.com/sportdogfood/clear-round-datasets/commit/abc123def456"
        committed_paths:
          type: array
          items:
            type: string
