# File: instructions.txt
# Runner: CRT bottom-runner (FULL INSTRUCTIONS)
# Version: v2025-12-01T08:55ET

====================================================================
ROLE OF THIS FILE
====================================================================
This is the authoritative contract for the CRT bottom-runner.
All modules (expeditor, researcher, writer, rewriter) MUST comply.
All mini/inlined instructions defer to this file.
No memory. No assumptions. No external verification.

====================================================================
GLOBAL PRINCIPLES
====================================================================
1. NO FABRICATION
   No module may create or guess factual details not in:
     • CompetitionPayload (Rows)
     • DestinationPayload (Rows)
     • Research output (this run ONLY)

2. NO VERIFICATION
   Researcher does NOT “check” values against reality.
   Missing → treat as unknown.

3. UNIFIED FALLBACK
   Missing/empty → "could-not-verify"
   Exception: lat/lng → null if not numeric.

4. DOWNSTREAM IGNORE RULE
   Writer/rewriter MUST ignore any "could-not-verify" values.

5. STRICT PASS-THROUGH
   DestinationPayload fields preserved exactly unless defined droppable.

6. DETERMINISTIC
   No randomness. No optional paths. No best-guess logic.

====================================================================
PIPELINE OVERVIEW
====================================================================

1) LOAD  
   Read CompetitionPayload + DestinationPayload.  
   creation_id must match.

2) EXPEDITOR  
   Produces:
     • locale-research-input.json
     • bottomblock-writer-input.json
   Mechanical shaping only.  
   No prose, no verification, no inference.

3) RESEARCHER  
   Input: locale-research-input.json  
   Output: locale-research-output.json  
   Descriptive only.  
   No external validation.  
   Missing → "could-not-verify".

4) WRITER  
   Inputs: writer-input + researcher-output  
   Output: bottomblock-writer-output.json  
   Creates:
     • stay paragraph + list
     • dine paragraph + list
     • essentials paragraph + list  
   MUST ignore “could-not-verify”.  
   No invention.

5) REWRITER  
   Input: writer-output  
   Output: bottomblock_final.json  
   Clean-up only.  
   No factual changes. No fabrication.

6) COMMIT  
   Logs → docs/runner/bottom/logs/{cid}-*.json  
   Final → docs/runner/bottom/finals/{cid}-bottomblock_final.json

====================================================================
INPUT SPECIFICATION
====================================================================

--------------- CompetitionPayload (Rows) ---------------
Required minimum fields:
- creation_id
- venue_name
- venue_acronym
- venue_official_url
- place_id
- lat, lng
- city, state, city_slug, zone
- span_start_date, span_end_date
- span_season, span_season_city_slug
- zoom_start_date, zoom_end_date
- zoom_season, zoom_season_city_slug
- collection_primary.zoom_leg_name
- collection_primary.comp_name

Missing/"" → "could-not-verify" (lat/lng → null)

--------------- DestinationPayload (Rows) ---------------
- creation_id
- hub_meta.hub_title_override
- stay.feature[] / stay.list-only[]
- dine.feature[] / dine.list-only[]
- essentials.feature[] / essentials.list-only[]

Each place row MUST preserve curated fields (no dropping):
- place_uid
- name, name2, entity
- price_band, price_level
- distance_bucket, distance_text, duration_text
- website
- editorial_overview
- formatted_address
- rating, user_ratings_total
- chain_slug, chain_types, all_types
- top_rated, preferred
- lat, lng
- Any other curated field unless meaningless.

Missing/"" → "could-not-verify" (lat/lng → null)

====================================================================
OUTPUT SPECIFICATION — EXPEDITOR
====================================================================

--------------- locale-research-input.json ---------------
{
  "creation_id": "<cid>",
  "event_identity": {
    "venue_name": "...",
    "venue_acronym": "...",
    "city": "...",
    "state": "...",
    "zone": "...",
    "span_season": "...",
    "span_season_city_slug": "...",
    "zoom_season": "...",
    "zoom_season_city_slug": "...",
    "span_start_date": "...",
    "span_end_date": "...",
    "zoom_start_date": "...",
    "zoom_end_date": "..."
  },
  "maps_anchor": {
    "place_id": "...",
    "lat": <number|null>,
    "lng": <number|null>
  }
}

--------------- bottomblock-writer-input.json ---------------
{
  "creation_id": "<cid>",
  "hub_meta": {
    "hub_title_override": "..."
  },
  "stay": {
    "feature": [ ... ],
    "list_only": [ ... ]
  },
  "dine": {
    "feature": [ ... ],
    "list_only": [ ... ]
  },
  "essentials": {
    "feature": [ ... ],
    "list_only": [ ... ]
  }
}

====================================================================
RESEARCHER CONTRACT
====================================================================
Uses locale-research-input.json AS GIVEN.
No verification.
Missing → “could-not-verify”.
Outputs structured, descriptive context.

====================================================================
WRITER CONTRACT
====================================================================
Uses researcher-output + writer-input.
Creates Stay/Dine/Essentials:
- paragraph
- list  
Ignores “could-not-verify”.
No invention.

====================================================================
REWRITER CONTRACT
====================================================================
Cleans Writer output.
No factual changes.

====================================================================
ERROR HANDLING
====================================================================
Pipeline halts when:
- Inputs missing/unreadable
- creation_id mismatch
- Invalid JSON

====================================================================
TROUBLESHOOTING — FIXED ISSUES
====================================================================
✓ locale_research_input exact shape  
✓ no external validation  
✓ unified fallback  
✓ no double-normalization  
✓ strict passthrough of curated rows  
✓ deterministic behavior

====================================================================
END OF FILE
====================================================================
