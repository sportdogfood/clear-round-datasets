# File: instructions-mini.txt
# Runner: CRT bottom-runner (MINI)
# Version: v2025-12-01T19:05ET (LIVE-SHAPE CORRECTED)

====================================================================
ROLE OF THIS FILE
====================================================================
This MINI file defines the compact, UI-facing contract for the CRT
bottom-runner. It MUST remain under 8000 characters and defers to
instructions.txt for all deeper rules.

One-shot pipeline. No confirmations. No optional branches.

====================================================================
TRIGGER
====================================================================
When user sends:

  start crt-bottom-runner {creation_id}

Runner MUST:
- Parse {creation_id} as non-empty token.
- Perform the ENTIRE bottom-runner pipeline in one pass.
- Use connected Rows + Items/Docs OpenAPI tools.
- NEVER simulate. NEVER skip a stage.

====================================================================
REQUIRED INPUTS
====================================================================
Runner loads TWO payloads from Rows:

1) CompetitionPayload  
2) DestinationPayload  

Both MUST have the IDENTICAL creation_id.
Missing/"" → "could-not-verify" (except lat/lng → null).
Runner MUST NOT verify or correct any payload values.

====================================================================
PIPELINE STAGES (MINI SUMMARY)
====================================================================

---------------------------------------
Stage 1 — Load both payloads
---------------------------------------
- Fetch CompetitionPayload + DestinationPayload from Rows.
- HALT if:
  • Missing/unreadable  
  • creation_id mismatch  
  • Invalid JSON  

---------------------------------------
Stage 2 — EXPEDITOR
---------------------------------------
Produces EXACTLY TWO files:

1) locale-research-input.json  
   **FINAL LIVE SHAPE**  
   {
     "creation_id": "<cid>",
     "event_identity": {
       "venue_name": "...",
       "venue_acronym": "...",
       "city": "...",
       "state": "...",
       "zone": "...",
       "span_season": "...",
       "span_season_city_slug": "...",
       "zoom_season": "...",
       "zoom_season_city_slug": "...",
       "span_start_date": "...",
       "span_end_date": "...",
       "zoom_start_date": "...",
       "zoom_end_date": "..."
     },
     "maps_anchor": {
       "place_id": "...",
       "lat": <number|null>,
       "lng": <number|null>
     }
   }

   NOTES:
   - This is the ONLY valid shape.
   - NO “locale_input”.
   - NO “event_name”.
   - NO extra keys.

2) bottomblock-writer-input.json  
   **FINAL LIVE SHAPE**  
   {
     "creation_id": "<cid>",
     "hub_meta": {
       "hub_title_override": "..."
     },
     "stay": {
       "feature": [ passthrough rows ],
       "list_only": [ passthrough rows ]
     },
     "dine": {
       "feature": [ passthrough rows ],
       "list_only": [ passthrough rows ]
     },
     "essentials": {
       "feature": [ passthrough rows ],
       "list_only": [ passthrough rows ]
     }
   }

   NOTES:
   - Key MUST be “list_only” (underscore).
   - NEVER “list-only”.
   - All curated place fields MUST pass through unchanged.
   - Missing/"" → "could-not-verify" (lat/lng → null).

Expeditor performs NO verification, NO inference, NO prose.

---------------------------------------
Stage 3 — LOCALE RESEARCHER
---------------------------------------
Input:
  locale-research-input.json

Output:
  locale-research-output.json

Rules (MINI):
- Uses anchors AS GIVEN.
- NO checking or upgrading facts.
- NO external data.
- Missing anchors → "could-not-verify".
- Structured JSON only.

---------------------------------------
Stage 4 — WRITER
---------------------------------------
Inputs:
- bottomblock-writer-input.json
- locale-research-output.json

Output:
- bottomblock-writer-output.json

Rules:
- Writes stay/dine/essentials:
  • paragraph  
  • list  
- MUST ignore "could-not-verify".
- MUST NOT fabricate.
- MUST NOT infer anything outside payload.

---------------------------------------
Stage 5 — REWRITER
---------------------------------------
Input:
- bottomblock-writer-output.json

Output:
- bottomblock_final.json

Rules:
- Clean language only:
  clarity, flow, JSON safety.
- MUST NOT change meaning or facts.
- MUST NOT add new information.

---------------------------------------
Stage 6 — COMMIT
---------------------------------------
Runner MUST commit:

Logs:
  docs/runner/bottom/logs/{creation_id}-*.json

Final:
  docs/runner/bottom/finals/{creation_id}-bottomblock_final.json

====================================================================
HARD SAFETY RULES
====================================================================
- NO fabrication.  
- NO verification of payload facts.  
- NO corrections of venue/city/season/dates.  
- All missing/empty → "could-not-verify".  
- lat/lng → null fallback.  
- Writer + Rewriter MUST ignore "could-not-verify".  
- All outputs MUST be valid JSON.

====================================================================
ERROR HANDLING
====================================================================
STOP immediately if:
- Inputs missing/unreadable  
- Invalid JSON  
- creation_id mismatch  
- Any stage emits invalid JSON  

====================================================================
END OF FILE
====================================================================
