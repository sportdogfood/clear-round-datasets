# File: instructions-mini.txt
# Runner: CRT bottom-runner (MINI)
# Version: v2025-12-01T09:07ET

====================================================================
ROLE OF THIS FILE
====================================================================
This MINI file is the compact UI-facing contract for the CRT
bottom-runner. It MUST remain under 8000 characters and ALWAYS
defers to the full rules in instructions.txt.

No confirmations. No optional branches. One-shot full pipeline.

====================================================================
TRIGGER
====================================================================
When user sends:
  
  start crt-bottom-runner {creation_id}

Runner MUST:
- Parse {creation_id} as a non-empty token.
- Perform the full bottom-runner pipeline in ONE pass.
- Use the connected Rows + Items/Docs OpenAPI tools.
- NEVER simulate, never “pretend,” never skip a stage.

====================================================================
REQUIRED INPUTS
====================================================================
The runner loads TWO payloads from Rows:

1) CompetitionPayload  
2) DestinationPayload  

Both MUST share the same creation_id or pipeline halts.

The runner MUST NOT validate or “fix” facts from either payload.
Missing or empty-string fields MUST become "could-not-verify"
(except lat/lng → null).

====================================================================
PIPELINE STAGES (SUMMARY)
====================================================================

---------------------------------------
Stage 1 — Load Competition + Destination
---------------------------------------
- Fetch both payloads from Rows.
- Halt if missing, malformed, or mismatch of creation_id.

---------------------------------------
Stage 2 — EXPEDITOR
---------------------------------------
- Produces EXACTLY two JSON files:
  
  1) locale-research-input.json
     Structure:
     {
       "creation_id": "<cid>",
       "event_identity": {
         "venue_name": "...",
         "venue_acronym": "...",
         "city": "...",
         "state": "...",
         "zone": "...",
         "span_season": "...",
         "span_season_city_slug": "...",
         "zoom_season": "...",
         "zoom_season_city_slug": "...",
         "span_start_date": "...",
         "span_end_date": "...",
         "zoom_start_date": "...",
         "zoom_end_date": "..."
       },
       "maps_anchor": {
         "place_id": "...",
         "lat": <number|null>,
         "lng": <number|null>
       }
     }

  2) bottomblock-writer-input.json
     Structure:
     {
       "creation_id": "<cid>",
       "hub_meta": {
         "hub_title_override": "..."
       },
       "stay": {
         "feature": [ passthrough place rows ],
         "list_only": [ passthrough place rows ]
       },
       "dine": {
         "feature": [ passthrough place rows ],
         "list_only": [ passthrough place rows ]
       },
       "essentials": {
         "feature": [ passthrough place rows ],
         "list_only": [ passthrough place rows ]
       }
     }

- NO verification or inference.
- Missing/"" → "could-not-verify".

---------------------------------------
Stage 3 — LOCALE RESEARCHER
---------------------------------------
Input:
  locale-research-input.json

Output:
  locale-research-output.json

Rules:
- Uses anchors AS GIVEN.  
- NEVER checks or upgrades facts.  
- NEVER creates unverifiable details.  
- Any unsupported field MUST become "could-not-verify" or empty
  array (with bucket added to could_not_verify).  
- Produces structured JSON only.

---------------------------------------
Stage 4 — WRITER
---------------------------------------
Inputs:
- bottomblock-writer-input.json
- locale-research-output.json

Output:
- bottomblock-writer-output.json

Rules:
- Produces equestrian-first bottom-block copy:
  • stay paragraph + list  
  • dine paragraph + list  
  • essentials paragraph + list  
- MUST ignore fields equal to "could-not-verify".  
- MUST NOT fabricate or infer missing information.  
- Only uses provided data.

---------------------------------------
Stage 5 — REWRITER
---------------------------------------
Input:
- bottomblock-writer-output.json

Output:
- bottomblock_final.json

Rules:
- Clean up, clarity, flow, JSON safety ONLY.  
- MUST NOT change meaning or introduce new facts.

---------------------------------------
Stage 6 — Commit
---------------------------------------
Runner MUST commit:
- All lane logs under:
    docs/runner/bottom/logs/{creation_id}-*.json

- Final output under:
    docs/runner/bottom/finals/{creation_id}-bottomblock_final.json

====================================================================
HARD SAFETY RULES (MINI)
====================================================================
- NO fabrication.  
- NO verification of payload facts.  
- NO corrections of venue/city/season/dates.  
- All missing/empty → "could-not-verify".  
- lat/lng fallback → null.  
- All downstream modules MUST ignore "could-not-verify".  
- All output MUST be valid JSON only.

====================================================================
ERROR HANDLING (MINI)
====================================================================
Runner stops hard if:
- Inputs missing or unreadable  
- Invalid JSON  
- creation_id mismatch  
- Any stage produces invalid JSON

====================================================================
END OF FILE
====================================================================
