# File: expeditor-spec.txt
# Version: v2025-12-01T08:27ET
# Runner: CRT bottom-runner (Expeditor)
# Status: UPDATED to authoritative schema + no-guessing contract

------------------------------------------------------------
Role
------------------------------------------------------------
This expeditor prepares the two mechanical inputs required by
the CRT bottom-runner:
1) locale-research-input.json
2) bottomblock-writer-input.json

It performs ONLY shaping and passthrough rules.
It NEVER generates prose.
It NEVER verifies facts against outside sources.
It NEVER fabricates missing data.

All deeper logic (research → writer → rewriter) lives in their
respective modules—not here.

------------------------------------------------------------
Inputs (read-only JSON files)
------------------------------------------------------------

1) CompetitionPayload  (from Rows CompetitionPayload sheet)
   Contains location, season, venue, dates, collection_primary,
   comps[], and all factual fields required for bottom-runner.

   Required fields (minimum):
   - creation_id
   - venue_name
   - venue_acronym
   - venue_official_url
   - place_id
   - lat, lng
   - city, state, city_slug, zone
   - span_start_date, span_end_date
   - span_season, span_season_city_slug
   - zoom_start_date, zoom_end_date
   - zoom_season, zoom_season_city_slug
   - collection_primary.zoom_leg_name
   - collection_primary.comp_name
   - Additional fields may be present; expeditor passes them
     through ONLY where specified by this file.

2) DestinationPayload (BottomPayload)
   - creation_id
   - hub_meta.hub_title_override
   - stay.feature[] / stay.list-only[]
   - dine.feature[] / dine.list-only[]
   - essentials.feature[] / essentials.list-only[]
   Each place row is curated from Rows and MUST be passed
   through with minimal filtering.

------------------------------------------------------------
Fallback policy (GLOBAL)
------------------------------------------------------------
Missing OR empty-string fields become:
    "could-not-verify"

Writer and rewriter will IGNORE "could-not-verify" and
will not assume any missing details. This prevents accidental
fabrication and avoids JSON malformed blanks.

------------------------------------------------------------
Output #1 — locale-research-input.json
------------------------------------------------------------
Purpose:
Provide the locale researcher with the exact anchor facts
they need for city/season/venue/positioning lanes. They do
NOT re-verify these values. They ONLY use them to perform
their descriptive task. They will not replace blanks and will
not guess missing data.

Required shape:

{
  "creation_id": "<cid>",
  "event_identity": {
    "venue_name": "<CompetitionPayload.venue_name>",
    "venue_acronym": "<CompetitionPayload.venue_acronym>",
    "city": "<CompetitionPayload.city>",
    "state": "<CompetitionPayload.state>",
    "zone": "<CompetitionPayload.zone>",
    "span_season": "<CompetitionPayload.span_season>",
    "span_season_city_slug": "<CompetitionPayload.span_season_city_slug>",
    "zoom_season": "<CompetitionPayload.zoom_season>",
    "zoom_season_city_slug": "<CompetitionPayload.zoom_season_city_slug>",
    "span_start_date": "<CompetitionPayload.span_start_date>",
    "span_end_date": "<CompetitionPayload.span_end_date>",
    "zoom_start_date": "<CompetitionPayload.zoom_start_date>",
    "zoom_end_date": "<CompetitionPayload.zoom_end_date>"
  },
  "maps_anchor": {
    "place_id": "<CompetitionPayload.place_id>",
    "lat": "<CompetitionPayload.lat>",
    "lng": "<CompetitionPayload.lng>"
  }
}

Fallback rule:
- ANY missing or "" → "could-not-verify"
- lat/lng become null ONLY if non-numeric

Researcher will never attempt to validate or override these.

------------------------------------------------------------
Output #2 — bottomblock-writer-input.json
------------------------------------------------------------
Purpose:
Provide writer with ALL curated listings for stay/dine/
essentials. Writer will generate:
- 1 short equestrian-first paragraph per lane
- 1 mobile-first list/table per lane
Writer does NOT verify any fact and does NOT fabricate.

Required shape:

{
  "creation_id": "<cid>",
  "hub_meta": {
    "hub_title_override": "<DestinationPayload.hub_meta.hub_title_override>"
  },
  "stay": {
    "feature": [ { passthrough place rows } ],
    "list_only": [ { passthrough place rows } ]
  },
  "dine": {
    "feature": [ { passthrough place rows } ],
    "list_only": [ { passthrough place rows } ]
  },
  "essentials": {
    "feature": [ { passthrough place rows } ],
    "list_only": [ { passthrough place rows } ]
  }
}

Where each place object MUST preserve, at minimum:
- place_uid (REQUIRED)
- name, name2, entity
- price_band, price_level
- distance_bucket, distance_text, duration_text
- top_rated, preferred
- website
- editorial_overview
- formatted_address
- lat, lng (if present)
- rating, user_ratings_total (if present)
- chain_slug, chain_types, all_types (if present)
- ANY other curated field should be preserved unless it
  is a meaningless internal metric.

Empty or missing fields → "could-not-verify" (except lat/lng → null).

------------------------------------------------------------
Error Handling
------------------------------------------------------------
Expeditor MUST stop and raise error if:
- Either input file missing or unparseable
- creation_id mismatch between CompetitionPayload and
  DestinationPayload

Expeditor MAY continue with empty arrays if a lane is missing.

------------------------------------------------------------
Non-goals
------------------------------------------------------------
Expeditor MUST NOT:
- Generate paragraphs or editorial text
- Recalculate price_band, rating, safety, etc.
- Invent any data
- Hit external APIs
- Perform research
- Combine research + writing (other modules handle that)

------------------------------------------------------------
Contract alignment notes (2025-12-01)
------------------------------------------------------------
- Entire pipeline must avoid assumptions.
- locale_research_input mirrors EXACT expected JSON shape.
- writer_input carries all curated places unchanged.
- Missing → "could-not-verify" unifies downstream behavior.
- All conform to bottom-runner researcher/writer contract.

# END OF FILE
