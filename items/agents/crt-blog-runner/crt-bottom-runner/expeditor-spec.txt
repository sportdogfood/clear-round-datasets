File: expeditor-spec.txt
Runner: crt-bottom-runner
Version: v0.2 – 2025-12-01

ROLE
- Defines the mechanical responsibilities of the bottom-runner expeditor.
- Expeditor performs ONLY fan-out and safe shaping.
- Expeditor does NOT:
  - generate prose,
  - research,
  - modify curated data,
  - add assumed fields,
  - perform business lookups,
  - depend on any top-runner logic.

SCOPE (BOTTOM-RUNNER)
For one creation_id, the expeditor:

1. Reads curated CompetitionPayload (Category A identity).
2. Reads curated DestinationPayload (“BottomPayload”: stay/dine/essentials).
3. Builds exactly TWO internal inputs:
   - locale_research_input.json
   - bottom_payload_normalized (later merged into bottomblock_research_clean.json)
4. Writes BOTH as docs logs for debugging.
5. Must NOT halt unless the payloads are missing or invalid JSON.

INPUTS (READ-ONLY)

-----------------------------------------------
1) CompetitionPayload (permanent schema)
-----------------------------------------------
- Fetched by runner-logic via Rows API, not by expeditor.
- Expeditor receives this already-loaded object.
- Expeditor MUST adapt to the fixed payload shape (NO assumptions, NO top-runner inheritance).

Required fields (these may exist or be empty, but never fabricated):
- creation_id
- venue_name
- city
- state
- zone
- span_start_date
- span_end_date
- span_season
- lat
- lng

Expeditor MUST NOT:
- expect season_label,
- expect zoom fields,
- expect collection_primary,
- expect editorial_overview,
- expect top-runner style structures.

Expeditor MUST accept missing fields and use "" for missing strings.

-----------------------------------------------
2) DestinationPayload (BottomPayload)
-----------------------------------------------
Permanent curated schema from Rows:

{
  "creation_id": "creator-abc",
  "hub_meta": { "hub_title_override": "..." },
  "stay": {
    "feature": [ { … place row … } ],
    "list-only": [ { … place row … } ]
  },
  "dine": {
    "feature": [ { … place row … } ],
    "list-only": [ { … place row … } ]
  },
  "essentials": {
    "feature": [ { … place row … } ],
    "list-only": [ { … place row … } ]
  }
}

Each place row includes curated, immutable fields such as:
- place_uid (required)
- name, name2
- entity
- distance_bucket, distance_text, duration_text
- price_band, price_level (optional)
- top_rated, preferred
- website (optional)
- editorial_overview (optional)
- lane-type fields (e.g. dine_lane)
- passthrough keys (chain_slug, all_types, etc.)

Expeditor MUST:
- Preserve all keys as-is.
- NEVER correct, infer, or invent data.
- NEVER search for missing fields.

-----------------------------------------------
OUTPUTS (EXPEDITOR WRITES)
-----------------------------------------------

The expeditor writes EXACTLY TWO JSON files into docs logs:

1) locale_research_input.json  
2) bottom_places_payload.json (debug copy of DestinationPayload)

These files are NOT used directly by the writer; they are used by:
- locale researcher → locale_research
- merge stage → bottomblock_research_clean.json

These outputs must use ASCII-only and must preserve original data.

-----------------------------------------------
1) locale-research-input.json
-----------------------------------------------
MUST conform to research-locale-prompt.txt.

Exact shape:

{
  "creation_id": "<CompetitionPayload.creation_id>",
  "locale_input": {
    "event_name": "<CompetitionPayload.event_name OR empty>",
    "venue_name": "<CompetitionPayload.venue_name>",
    "city": "<CompetitionPayload.city>",
    "state": "<CompetitionPayload.state>",
    "zone": "<CompetitionPayload.zone>",
    "span_start_date": "<CompetitionPayload.span_start_date>",
    "span_end_date": "<CompetitionPayload.span_end_date>",
    "span_season": "<CompetitionPayload.span_season>",
    "lat": "<CompetitionPayload.lat>",
    "lng": "<CompetitionPayload.lng>"
  }
}

Rules:
- NO zoom fields.
- NO derived season_label.
- NO top-runner identities.
- NO business lists.
- Default "" where fields are missing.
- MUST NOT invent values.
- MUST use exactly “locale_input”.

-----------------------------------------------
2) bottom_payload_normalized (debug copy)
-----------------------------------------------

Expeditor logs bottom places payload as-is:

{
  "creation_id": "<BottomPayload.creation_id>",
  "stay": {
    "feature": [ ... ],
    "list-only": [ ... ]
  },
  "dine": {
    "feature": [ ... ],
    "list-only": [ ... ]
  },
  "essentials": {
    "feature": [ ... ],
    "list-only": [ ... ]
  },
  "hub_meta": { ... }
}

Expeditor MUST:
- Keep “list-only”.
- NOT rename keys to “list_only”.
- NOT drop fields.
- NOT modify place objects.

-----------------------------------------------
BEHAVIOR RULES
-----------------------------------------------

NO BUSINESS LOGIC
- No recomputation of distance_bucket, price_band, or any field.
- No enrichment.
- No fallback heuristics.
- No assumptions about missing fields.
- Do not remove “could-not-verify” fields if present.

NO PROSE GENERATION
- No paragraphs.
- No rewriting.
- No suggestions.

NO TOP-RUNNER CROSS-CONTAMINATION
- No zoom_season, collection_primary, zoom_leg_name.
- No season_label expected from upstream.
- No top-runner file paths.

ERROR HANDLING (STRICT)
- Expeditor halts ONLY if:
  - CompetitionPayload is missing OR invalid JSON.
  - DestinationPayload is missing OR invalid JSON.

Otherwise:
- Expeditor must proceed, even if fields are blank or incomplete.
- Missing fields → "" or empty arrays (permanent rule).
- NEVER halt due to missing span_season, editorial_overview, or season_label.

-----------------------------------------------
NON-GOALS
-----------------------------------------------

Expeditor does NOT:
- Perform research.
- Create any writer/rewriter inputs directly.
- Write final outputs.
- Call the Rows API.
- Change any curated schema.
- Validate URL correctness.
- Apply ranking or filtering.

-----------------------------------------------
SUMMARY (MECHANICAL CONTRACT)
-----------------------------------------------

Expeditor MUST:
1. Consume CompetitionPayload and DestinationPayload exactly as they exist.
2. Build locale_research_input.json exactly matching the research prompt.
3. Log both inputs to Docs without altering curated data.
4. Never assume top-runner schemas.
5. Never require editorial_overview, season_label, zoom fields.
6. Never halt unless payloads are missing or invalid JSON.

END OF FILE
