File: expeditor-spec.txt (bottom-runner)

Role
- This expeditor prepares the inputs for the CRT bottom-runner.
- It does only mechanical fan-out and light shaping.
- It does NOT call any external APIs, does NOT generate prose, and does NOT make up new fields.

Scope (bottom-runner)
- For a single creation_id, expeditor:
  - Reads the shared CompetitionPayload JSON (top payload).
  - Reads the BottomPayload JSON (stay/dine/essentials hub payload).
  - Builds:
    - A small locale-research input JSON.
    - A compact bottom-block writer input JSON.
- All research, writing, and rewriting is handled elsewhere (researcher, writer, rewriter).

Inputs (read-only JSON files)

1) CompetitionPayload
- Path (example, actual path controlled by runner config):
  - items/…/competition-payload.json
- Shape: the same object used by the top-runner, including at least:
  - creation_id
  - venue_name
  - venue_acronym
  - venue_official_url
  - place_id
  - lat, lng
  - city, state, city_slug, zone
  - span_start_date, span_end_date, span_season, span_season_city_slug
  - zoom_start_date, zoom_end_date, zoom_season, zoom_season_city_slug
  - any other fields needed for locale context

2) BottomPayload
- Path (example):
  - items/…/bottom-payload.json
- Shape (minimum):

{
  "creation_id": "creator-abc",
  "hub_meta": {
    "hub_title_override": "..."
  },
  "stay": {
    "feature": [ { … place row … }, … ],
    "list-only": [ { … place row … }, … ]
  },
  "dine": {
    "feature": [ { … place row … }, … ],
    "list-only": [ { … place row … }, … ]
  },
  "essentials": {
    "feature": [ { … place row … }, … ],
    "list-only": [ { … place row … }, … ]
  }
}

- Each place row is a curated item from Rows, similar to the example you provided, including:
  - creation_id, lane, role, rank
  - place_uid (internal key, required)
  - place_id (optional but preserved if present)
  - name, name2, entity
  - price_band, price_level (may be missing or unreliable)
  - distance_bucket, distance_text, duration_text
  - top_rated, preferred
  - website, url (maps), formatted_address (optional)
  - editorial_overview (optional, short text)
  - other passthrough fields (chain_slug, chain_types, all_types, etc.)

Outputs (expeditor writes these JSON files)

1) locale-research-input.json
- Path (example):
  - items/…/locale-research-input.json
- Purpose:
  - Give the locale researcher a compact view of:
    - Where this event lives (city/state, zone, venue).
    - When it happens (span/zoom dates; season labels).
    - The fact that we care about “nearby resets” and “things to do close by”.
- Shape (minimum):

{
  "creation_id": "<CompetitionPayload.creation_id>",
  "event_identity": {
    "venue_name": "<CompetitionPayload.venue_name>",
    "venue_acronym": "<CompetitionPayload.venue_acronym>",
    "city": "<CompetitionPayload.city>",
    "state": "<CompetitionPayload.state>",
    "zone": "<CompetitionPayload.zone>",
    "span_season": "<CompetitionPayload.span_season>",
    "span_season_city_slug": "<CompetitionPayload.span_season_city_slug>",
    "zoom_season": "<CompetitionPayload.zoom_season>",
    "zoom_season_city_slug": "<CompetitionPayload.zoom_season_city_slug>",
    "span_start_date": "<CompetitionPayload.span_start_date>",
    "span_end_date": "<CompetitionPayload.span_end_date>",
    "zoom_start_date": "<CompetitionPayload.zoom_start_date>",
    "zoom_end_date": "<CompetitionPayload.zoom_end_date>"
  },
  "maps_anchor": {
    "place_id": "<CompetitionPayload.place_id>",
    "lat": "<CompetitionPayload.lat>",
    "lng": "<CompetitionPayload.lng>"
  }
}

- No place lists are needed here; this file is only for city/season/locale research.

2) bottomblock-writer-input.json
- Path (example):
  - items/…/bottomblock-writer-input.json
- Purpose:
  - Give the bottom-block writer everything needed to write:
    - A short, equestrian-specific paragraph for each lane (stay/dine/essentials).
    - A tight, mobile-first list/table backing each lane.
- Shape (minimum):

{
  "creation_id": "<BottomPayload.creation_id>",
  "hub_meta": {
    "hub_title_override": "<BottomPayload.hub_meta.hub_title_override>"
  },
  "stay": {
    "feature": [ { … curated stay places … } ],
    "list_only": [ { … curated stay places … } ]
  },
  "dine": {
    "feature": [ { … curated dine places … } ],
    "list_only": [ { … curated dine places … } ]
  },
  "essentials": {
    "feature": [ { … curated essentials places … } ],
    "list_only": [ { … curated essentials places … } ]
  }
}

- For each place object, expeditor:
  - Copies fields from BottomPayload as-is (no rewriting).
  - MUST preserve at least:
    - place_uid
    - name, name2, entity
    - price_band (if present), price_level (if present)
    - distance_bucket, distance_text, duration_text
    - top_rated, preferred
    - website
    - editorial_overview (if present)
  - May drop fields that are clearly irrelevant to copy (e.g. low-level internal metrics), but should err on the side of keeping existing keys.

Behavior and rules

- One creation_id at a time:
  - Expeditor assumes both CompetitionPayload and BottomPayload refer to the same creation_id.
  - If creation_id does not match, expeditor should fail fast (no outputs) and surface an error to the runner.

- No business logic:
  - Do NOT:
    - Recalculate price_band, price_level, rating, or user_ratings_total.
    - Change distance_bucket or distance_text.
    - Add “safety” labels or any editorial flags.
  - Only pass through the curated values that already exist.

- No prose generation:
  - Do NOT:
    - Write paragraphs, sentences, or final copy.
    - Try to “summarize” the lists.
  - The writer and rewriter prompts will handle all narrative.

Non-goals

- This expeditor is not responsible for:
  - Calling Rows APIs directly (that happens upstream in runner logic).
  - Any HTTP lookups (Expedia, Google, etc.).
  - Any validation beyond basic shape and creation_id consistency.
  - Any publishing to Docs; it only prepares items/… JSONs that the runner then uses.

Error handling (high-level)

- If either input file is missing or invalid JSON:
  - Do not create any outputs.
  - Return/raise a clear error for the runner layer (e.g. “missing competition-payload.json” or “bottom-payload.json parse error”).

- If required fields are missing (e.g. no stay/dine/essentials keys at all):
  - Expeditor may still write what it can, but should keep the missing sections as empty arrays, not null.
