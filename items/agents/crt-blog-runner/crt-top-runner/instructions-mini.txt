--------------------------------------------------
Header
--------------------------------------------------

File: instructions-mini.txt
Version: v2.1
Timestamp: 2025-12-03T00:00:00Z

Purpose:
To run the CRT top-runner pipeline end-to-end for one creation_id
with minimal noise but clear timestamped trace logs for learning and QA.

--------------------------------------------------
0. Trigger
--------------------------------------------------

Command:
  start crt-top-runner {creation_id}

Example:
  start crt-top-runner creator-abc

--------------------------------------------------
1. General Behavior
--------------------------------------------------

- Execute all eight pipeline stages in sequence with no manual prompts.
- Perform live commits when integrations are authenticated.
- If authentication missing, run in safe simulation mode.
- Never skip a stage silently.
- Always record a full trace log, even on failure.

--------------------------------------------------
2. Stage List
--------------------------------------------------

1. rows_fetch          → read CompetitionPayload (Rows API)
2. expeditor           → build lane inputs
3. event_research      → run event lane
4. venue_research      → run venue lane
5. city_research       → run city/season lane
6. merge_bundle        → merge and validate research bundle
7. topblock_writer     → generate top-block paragraphs
8. topblock_rewriter   → clean language and commit finals

All eight must run in order; if one fails, stop and log failure.

--------------------------------------------------
3. Logging Rules
--------------------------------------------------

Primary trace log:
  docs/runner/top/logs/{creation_id}-trace.log

Each entry format:
  [ISOtimestamp] [stage_name] [status] [brief message]

Example:
  [2025-12-03T12:04:22Z] [rows_fetch] OK – payload loaded
  [2025-12-03T12:04:25Z] [event_research] OK – sources verified
  [2025-12-03T12:04:35Z] [merge_bundle] OK – bundle built
  [2025-12-03T12:04:40Z] [topblock_writer] OK – copy generated
  [2025-12-03T12:04:45Z] [topblock_rewriter] OK – final committed

If a stage fails:
  [ISOtimestamp] [stage_name] FAIL – reason

Always append chronologically; never overwrite an existing trace.

--------------------------------------------------
4. Outputs
--------------------------------------------------

- Stage JSONs:
    docs/runner/top/logs/{creation_id}-event_research.json
    docs/runner/top/logs/{creation_id}-venue_research.json
    docs/runner/top/logs/{creation_id}-city_research.json
    docs/runner/top/logs/{creation_id}-topblock_research_clean.json
    docs/runner/top/logs/{creation_id}-topblock_writer.json
    docs/runner/top/logs/{creation_id}-topblock_final.json
    docs/runner/top/logs/{creation_id}-trace.log

- Final publish file:
    docs/runner/top/finals/{creation_id}-topblock_final.json

Each file must include a version and timestamp header.

--------------------------------------------------
5. UI / Console Output
--------------------------------------------------

During execution show short trace lines:
  [rows_fetch] …done  
  [event_research] …done  
  etc.

On success:
  ✅ Run completed – all stages passed.
  Version: v2.1 | Timestamp: {run_start_ISO}

On failure:
  ❌ Stage [name] failed – see trace log for details.

--------------------------------------------------
6. Safety and Validation
--------------------------------------------------

- Respect competition payload as the truth model.
- Use “could-not-verify” only when validation fails.
- Never hallucinate or upgrade prestige/rating.
- Verify that event, venue, and city lanes exist before merge.
- If any stage aborts, write a FAIL entry and halt.

--------------------------------------------------
7. Versioning and Provenance
--------------------------------------------------

Each trace log and final JSON must include:
  - runner_version: v2.1
  - run_timestamp: {ISO8601 datetime}
  - creation_id
  - commit_sha (when available)

Example JSON header:
  {
    "runner_version": "v2.1",
    "run_timestamp": "2025-12-03T12:04:46Z",
    "creation_id": "creator-abc",
    "commit_sha": "5ec193e1e2971db68d6eaa2e643010e819fc22c6",
    ...
  }

--------------------------------------------------
8. Learning and Review
--------------------------------------------------

The trace log is the authoritative record for QA.
Review it after every test to confirm:
  - All stages executed in order
  - No skipped lanes
  - Realistic timing and durations

Retain trace logs for regression comparisons between versions.

--------------------------------------------------
End of File
--------------------------------------------------
