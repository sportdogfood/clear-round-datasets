// File: instructions-mini.txt
// Version: v2.1
// Timestamp: 2025-12-03T23:00:00Z
// Author: CRT Engineering
// Purpose: Trace-enabled full runner definition with version + time metadata

--------------------------------------------------
Header
--------------------------------------------------

This file defines the CRT Top-Runner behavior for a single creation_id.
It enables live commits, ensures all eight stages run in order, and writes
timestamped logs for human-readable review.

--------------------------------------------------
Trigger
--------------------------------------------------

Command:
  start crt-top-runner {creation_id}

Example:
  start crt-top-runner creator-abc

--------------------------------------------------
Stage Sequence
--------------------------------------------------

1. rows_fetch          → fetch CompetitionPayload
2. expeditor           → build lane inputs
3. event_research      → event lane
4. venue_research      → venue lane
5. city_research       → city/season lane
6. merge_bundle        → combine and clean research data
7. topblock_writer     → generate natural copy
8. topblock_rewriter   → finalize and commit to docs

All stages must run in order; stop and log if one fails.

--------------------------------------------------
Logging
--------------------------------------------------

Trace log path:
  docs/runner/top/logs/{creation_id}-trace.log

Each entry:
  [ISOtimestamp] [stage_name] [status] [short message]

Example entries:
  [2025-12-03T12:04:22Z] [rows_fetch] OK – payload loaded
  [2025-12-03T12:04:35Z] [merge_bundle] OK – bundle built
  [2025-12-03T12:04:45Z] [topblock_rewriter] OK – final committed

If failure:
  [ISOtimestamp] [stage_name] FAIL – reason

Always append chronologically; never overwrite an existing trace.

--------------------------------------------------
Outputs
--------------------------------------------------

Logs:
  docs/runner/top/logs/{creation_id}-event_research.json
  docs/runner/top/logs/{creation_id}-venue_research.json
  docs/runner/top/logs/{creation_id}-city_research.json
  docs/runner/top/logs/{creation_id}-topblock_research_clean.json
  docs/runner/top/logs/{creation_id}-topblock_writer.json
  docs/runner/top/logs/{creation_id}-topblock_final.json
  docs/runner/top/logs/{creation_id}-trace.log

Final file:
  docs/runner/top/finals/{creation_id}-topblock_final.json

--------------------------------------------------
UI Output
--------------------------------------------------

Show minimal console trace:
  [rows_fetch] …done  
  [event_research] …done  
  etc.

On success:
  ✅ Run completed – all stages passed.
  Version: v2.1 | Timestamp: {run_start_ISO}

On failure:
  ❌ Stage [name] failed – see trace log.

--------------------------------------------------
Versioning Metadata
--------------------------------------------------

Each final JSON must include:
  runner_version: v2.1
  run_timestamp: {ISO8601 datetime}
  creation_id
  commit_sha (if available)

Example:
  {
    "runner_version": "v2.1",
    "run_timestamp": "2025-12-03T12:04:46Z",
    "creation_id": "creator-abc",
    "commit_sha": "5ec193e1e2971db68d6eaa2e643010e819fc22c6"
  }

--------------------------------------------------
Safety
--------------------------------------------------

- Respect CompetitionPayload as truth source.
- No hallucinations or prestige upgrades.
- Use “could-not-verify” only when sources fail validation.
- Validate all three research lanes before merge.
- Always log before aborting.

--------------------------------------------------
End of File
--------------------------------------------------
