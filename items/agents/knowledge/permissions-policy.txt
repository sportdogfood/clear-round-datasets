# permissions-policy.txt
# Clear Round Travel - Kernel & Agents
# Version: v1
# Last updated: 2025-09-02 now

Purpose
-------
Defines who can do what, when a PR is required, and which changes need explicit approval.

Lanes (definitions)
-------------------
GREEN  = Safe, reversible, low-risk. Auto-commit allowed.
YELLOW = Review required. PR-by-default. No direct commit by Agent/Codex.
RED    = Sensitive or structural. Explicit human approval required in PR.

Default write policy
--------------------
- Agent: PR-by-default. Must show PREVIEW; no write until Human issues COMMIT. May direct-commit GREEN only if Human explicitly instructs it for that action.
- Codex: PR-only for docs/code. No dataset writes unless explicitly authorized in task scope.
- Human: May direct-commit GREEN. For YELLOW and RED, open a PR.

Lane mapping (typical)
----------------------
GREEN
- Docs only: knowledge files, brief edits, scaffolds, minor hygiene (<=200 lines).
- Registry sync with Airtable: dir-map.json updates when fields are stable and change is small.
- Non-write domains outputs (research/query/create/reminders).

YELLOW
- ADD: add-event (hub), add-event legs, add place entities (hotels/restaurants/airbnbs/rvparks).
- UPDATE: safe fields only (display_name, official_link, labels, minor description).
- Dataset mechanics that do not change semantics (ordering keys, formatting, small refactors).
- Knowledge edits that change guidance but not policy.

RED
- Date changes to a live leg (events).
- Renames, moves, or path changes; deletes of dataset files.
- Relation changes that alter identity (venue_uid, organizer_uid, source_uid).
- Schema changes or new required fields.
- Bulk edits: >10 files or widespread rewrites.
- Any change that would force UID or path churn.

Domain-specific notes
---------------------
ADD
- Always PREVIEW -> COMMIT.
- Hub + legs are in index/events/. No separate event-series entity.
- Adds are YELLOW unless adding would overwrite an existing file (then stop; no write).

UPDATE
- PREVIEW must include before/after and diff counts.
- Sensitive changes (dates, relations, airports, divisions) are RED.
- Safe copy/link tweaks are YELLOW.

RESEARCH / QUERY / CREATE / REMINDERS
- No writes. Always GREEN. Return structured outputs per task schema.

Conflict policy
---------------
- If HEAD changed since PREVIEW, fail safe. Do not force-merge. Re-run PREVIEW.

Allowlist and paths
-------------------
- All writes must be under an ALLOW_DIRS prefix.
- Paths must be derived from dir-map.json (v2) and naming-policy.txt.
- No ad-hoc trees or side directories.

Approvals and attribution
-------------------------
- PRs must include a clear message (feat/fix/chore/docs), scope, and why.
- RED requires explicit human approval recorded in the PR.
- Include rollback note (how to revert) in PR body.
- Attribute actor in commit message: human/agent/codex.

Examples (lane guidance)
------------------------
- GREEN: "docs(knowledge): tighten add-event brief; 42 lines changed"
- YELLOW: "feat(events): add hub + 10 legs for Desert Circuit (previewed)"
- RED: "refactor(events): move files to new date scheme" -> requires explicit approval

Change control
--------------
- Updates to this policy are YELLOW (PR required).
- Any relaxation of lanes must be called out in the PR description.
