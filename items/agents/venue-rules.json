{
  "name": "venue-rules",
  "version": "v3",
  "table": "venues",
  "prefix": "venue_",
  "uid_immutable": true,

  "naming": {
    "field_case": "snake_case",
    "uid_charset_regex": "^[a-z0-9]+(?:-[a-z0-9]+)*$",
    "filename_equals_uid": true,
    "uid_must_end_with": "-venue"
  },

  "base_vars": [
    "venue_uid",
    "venue_image",
    "venue_name",
    "venue_display_name",
    "venue_recordId"
  ],

  "uid_rule": "venue_uid = ensure_suffix(slugify(venue_name), '-venue')",
  "uid_requires": ["venue_name"],

  "required_fields": [
    "venue_link",
    "created_date",
    "last_updated",
    "city_uid",
    "state_uid",
    "country_uid"
  ],

  "optional_fields": [
    "venue_address_line1",
    "venue_address_line2",
    "venue_zip",
    "venue_county",
    "venue_timezone",
    "venue_elevation_m",
    "venue_google_pin",
    "venue_openstreetmap_id",
    "venue_geo_lat",
    "venue_geo_long",
    "boundary_geojson",
    "map_tile_source",
    "notes",
    "form_uid",
    "git_status"
  ],

  "relations": {
    "city_uid":      { "type": "single", "required": true },
    "state_uid":     { "type": "single", "required": true },
    "country_uid":   { "type": "single", "required": true },
    "airport_uids":  { "type": "multi",  "required": false },
    "weather_uid":   { "type": "single", "required": false },
    "events_uids":   { "type": "multi",  "required": false },
    "organizer_uids":{ "type": "multi",  "required": false },
    "source_uids":   { "type": "multi",  "required": true, "min_items": 1 },
    "label_uids":    { "type": "multi",  "required": false }
  },

  "location_normalizers_required": [
    "countries", "states", "cities", "airports", "weather", "labels"
  ],

  "date_policies": {
    "format": "YYYY-MM-DD"
  },

  "geo_policies": {
    "lat_field": "venue_geo_lat",
    "long_field": "venue_geo_long",
    "pin_field": "venue_google_pin",
    "lat_range": [-90, 90],
    "long_range": [-180, 180],
    "lat_long_required": false,
    "timezone_format": "IANA"
  },

  "image_policy": {
    "allow_external_cdn": true,
    "disallow_ephemeral_links": true
  },

  "source_uid_policy": {
    "construction": "domain_slug",
    "domain_slug_rule": "lowercase primary domain; dots→hyphens (e.g., usef.org → usef-org)",
    "source_type_hint": "first path token or identifying key (e.g., '/', 'events', 'search', 'ShowGUID')",
    "flags": { "is_official": "y|n", "is_favorite": "y|n" }
  },

  "validation": {
    "venue_uid_must_end_with_suffix": true,
    "official_link_must_be_https": true,
    "relations_must_resolve": true,
    "halt_on_missing_normalizer": true,
    "timezone_must_be_valid_iana": true,
    "no_ad_hoc_values": true,
    "fact_only_fields": true,
    "bool_encoding": "yn",
    "ignore_prefixes": ["dnu_", "ignore_"],
    "on_failure": ["needs_review", "needs_normalizer", "invalid_geo", "invalid_timezone"]
  },

  "paths": {
    "save_path_template": "index/venues/{venue_uid}.json",
    "sources_input_dir": "index/sources"
  },

  "enrichment": {
    "priority": [
      "country_uid",
      "state_uid",
      "city_uid",
      "airport_uids",
      "weather_uid",
      "venue_geo_lat",
      "venue_geo_long",
      "venue_timezone",
      "venue_address_line1",
      "venue_zip"
    ],
    "inheritance_notes": "Events reference venue for authoritative location; downstream content (stay, dine, locale, weather) keys off venue or explicit this_stay."
  }
}
