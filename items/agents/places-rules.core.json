{
  "version": "v1.0",
  "lane": "research_places",
  "dirs": {
    "items_root": "items/places",
    "path_template": "items/places/{city_uid}/",
    "filenames": {
      "curated": "curated_places.json",
      "review": "places_review_queue.json"
    },
    "filename_equals_uid": false
  },
  "policy": {
    "providers": ["google", "yelp", "osm"],
    "https_only": true,
    "idempotent_commits": true,
    "write_requires_summary": true
  },
  "schemas": {
    "input_place_min": {
      "name": "string",
      "primaryType": "string|null",
      "types": "array|null",
      "rating": "number|null",
      "userRatingCount": "number|null",
      "website": "string|null",
      "priceLevel": "number|string|null",
      "id": "string"
    },
    "output_row": {
      "source_provider": "string",
      "source_place_id": "string",
      "name": "string",
      "cuisine": "string|null",
      "cuisine_source": "string|null",
      "price_tier": "string|null",
      "price_source": "string|null",
      "rating": "number|null",
      "userRatingCount": "number|null",
      "website": "string|null",
      "open_now": "boolean|null",
      "bucket": "string|null",
      "distance_m": "number|null",
      "distance_bucket": "string|null",
      "score": "number",
      "confidence": "string",
      "confidence_reasons": "string",
      "types": "array|null",
      "primaryType": "string|null",
      "flags": "object|null"
    }
  },
  "defaults": {
    "fetch": {
      "google": {
        "search_mode": "nearby",
        "rankPreference": "POPULARITY",
        "maxResultCount": 20,
        "includedPrimaryTypes": [
          "restaurant",
          "italian_restaurant",
          "mexican_restaurant",
          "steak_house",
          "sushi_restaurant",
          "greek_restaurant",
          "thai_restaurant",
          "indian_restaurant",
          "pizza_restaurant",
          "seafood_restaurant",
          "vegan_restaurant"
        ],
        "includedTypes": ["cafe", "bakery", "bar"],
        "field_mask_search": [
          "id",
          "displayName",
          "primaryType",
          "types",
          "rating",
          "userRatingCount",
          "websiteUri",
          "currentOpeningHours.openNow"
        ],
        "details_for_place_ids": "y",
        "field_mask_details": [
          "id",
          "formattedAddress",
          "nationalPhoneNumber",
          "priceLevel",
          "takeout",
          "delivery",
          "dineIn",
          "reservable",
          "goodForGroups",
          "goodForKids",
          "outdoorSeating"
        ]
      },
      "yelp": {
        "enable": "y",
        "fields": ["price", "categories", "rating", "review_count", "url"]
      },
      "osm": {
        "enable": "y",
        "tags": ["amenity=restaurant", "amenity=cafe", "amenity=fast_food", "amenity=bar", "amenity=pub"],
        "fields": ["name", "cuisine", "website", "phone"]
      }
    },
    "knobs": {
      "dedupe": {
        "by": ["place_id", "name"],
        "name_fuzzy": "y",
        "same_location_threshold_m": 75
      },
      "filters": {
        "open_now": null,
        "min_rating": 4.0,
        "min_reviews": 50,
        "include_types": [],
        "exclude_types": ["fast_food_restaurant"]
      },
      "derive": {
        "cuisine": {
          "from": ["primaryType", "types", "yelp.categories", "osm.cuisine"],
          "strip_suffix": "_restaurant",
          "fallback_tokens": ["cafe", "bakery", "bar", "pizzeria", "steak_house", "seafood_restaurant", "vegan"],
          "label_case": "title"
        },
        "price_tier": {
          "from": ["priceLevel", "yelp.price"],
          "map_numeric": ["$", "$$", "$$$", "$$$$", "$$$$$"]
        },
        "bucket": {
          "strategy": "type_then_cuisine",
          "special_types": {
            "Cafe/Bakery": ["cafe", "bakery"],
            "Bar": ["bar"]
          }
        }
      },
      "distance": {
        "enable": "y",
        "center": {"lat": 0, "lng": 0},
        "walkable_m": 800,
        "short_drive_m": 6000,
        "output_field": "distance_m",
        "bucket_field": "distance_bucket"
      },
      "scoring": {
        "formula": "rating_log_reviews",
        "weights": {
          "rating": 1.0,
          "log_reviews": 1.0,
          "proximity_bonus": 0.3,
          "flags_bonus": 0.2
        },
        "round_to": 3
      },
      "confidence": {
        "signals": {
          "has_cuisine": true,
          "has_price": true,
          "rating_ge": 4.2,
          "reviews_ge": 100,
          "has_website": true
        },
        "tiers": {
          "high_min": 3,
          "medium_min": 2
        }
      },
      "split": {
        "curated_if": {
          "confidence_in": ["high", "medium"],
          "require_one_of": ["cuisine", "website"]
        },
        "review_else": true,
        "review_checklist": [
          {"when_missing": "price_tier", "action": "add price"},
          {"when_missing": "cuisine", "action": "confirm cuisine"},
          {"when_false": "has_website", "action": "add website"}
        ]
      },
      "output": {
        "format": "arrays",
        "fields": {
          "order": [
            "source_provider",
            "source_place_id",
            "name",
            "cuisine",
            "cuisine_source",
            "price_tier",
            "price_source",
            "rating",
            "userRatingCount",
            "website",
            "open_now",
            "bucket",
            "distance_m",
            "distance_bucket",
            "score",
            "confidence",
            "confidence_reasons",
            "types",
            "primaryType",
            "flags"
          ],
          "rename": {
            "source_place_id": "place_id",
            "userRatingCount": "reviews"
          },
          "omit_nulls": true
        },
        "deliver": {
          "curated_key": "curated",
          "review_key": "review",
          "include_summary": "y",
          "include_meta": "y"
        }
      }
    }
  },
  "audience": {
    "procure_for": {
      "brand": "Clear Round Travel",
      "mission": "Curate dining for equestrian show weeks with fast, reliable options near venues.",
      "personas": [
        {"key": "show_mom", "needs": ["reservable", "goodForKids", "parking_ease", "quick_service"]},
        {"key": "trainer_team", "needs": ["goodForGroups", "late_hours", "outdoorSeating", "takeout"]},
        {"key": "junior_rider", "needs": ["healthy_options", "smoothie_breakfast", "budget_friendly"]},
        {"key": "date_night", "needs": ["higher_rating", "reservable", "ambient", "wine_program"]}
      ],
      "price_tiers_allow": ["$", "$$", "$$$"],
      "exclude_types": ["fast_food_restaurant"]
    },
    "dayparts": {
      "breakfast": "06:00-10:30",
      "lunch": "11:00-14:30",
      "dinner": "17:00-22:00",
      "late": "22:00-01:00"
    },
    "buckets": [
      {"key": "Walkable", "desc": "≤800 m from venue"},
      {"key": "<10-min drive", "desc": "≤6000 m from venue"},
      {"key": "Breakfast near barns", "desc": "early open + coffee/bakery"},
      {"key": "Quick grab & go", "desc": "takeout/delivery emphasis"},
      {"key": "Family-friendly", "desc": "goodForKids + groups"},
      {"key": "Date-night", "desc": "higher rating + reservable"}
    ],
    "ranking_bias": {
      "reservable": 0.2,
      "goodForGroups": 0.2,
      "outdoorSeating": 0.15,
      "open_late": 0.15,
      "breakfast": 0.15
    }
  },
  "commit": {
    "stash": {
      "folder": "items/places/{city_uid}/",
      "filenames": {
        "curated": "curated_places.json",
        "review": "places_review_queue.json"
      }
    },
    "write": {
      "enabled": "n",
      "message_tmpl": "feat(places): curate {city_uid} — {rows_curated} curated, {rows_review} review"
    }
  },
  "created": "2025-09-15T00:00:00Z",
  "last_updated": "2025-09-15T00:00:00Z"
}
