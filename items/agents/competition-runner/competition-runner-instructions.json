{
  "runner": "competition-runner",
  "version": "1.4.0",
  "notes": "Top-brick writer for CRT competition blogs. Reads a collections-payload from Rows, then generates event, venue, host_city, hello, and seo in separate phases before assembling a single competition-output file.",
  "io_contract": {
    "input": {
      "creation_id": "string, required. Example: 'creator-abc'."
    },
    "tools": {
      "rows": {
        "operation_id": "getCompetitionPayloadRows",
        "endpoint": "/spreadsheets/GqOwXTcrQ9u14dbdcTxWa/tables/18be0a0d-dbea-43ea-811f-f7bcbf4982d3/values/A2:B999",
        "response": {
          "root_array_field": "items",
          "row_shape": [
            "creation_id",
            "payload_json_string"
          ],
          "selection_rule": "Find first row where row[0] == creation_id; parse row[1] as JSON into collections_payload; if none, stop with error."
        }
      },
      "crt": {
        "read": {
          "operation_id": "items_get",
          "paths": {
            "blueprint": "agents/competition-runner/competition-runner-instructions.json",
            "qa_config": "agents/competition-runner/qa-config.json"
          }
        },
        "write": {
          "operation_id": "docs_commit_bulk",
          "path_template": "docs/runner/competition-output.{creation_id}.json",
          "content_type": "application/json"
        }
      }
    },
    "output": {
      "path_template": "docs/runner/competition-output.{creation_id}.json",
      "description": "One JSON object per creation_id with meta + hello + event + venue + host_city + seo + flags. No HTML."
    }
  },
  "collections_payload_contract": {
    "root": "collections_payload",
    "primary_collection_path": "collections_payload.collection_primary",
    "primary_fields": {
      "span_start_date": "collections_payload.span_start_date",
      "span_end_date": "collections_payload.span_end_date",
      "span_season": "collections_payload.span_season",
      "span_season_city_slug": "collections_payload.span_season_city_slug",
      "span_rating": "collections_payload.span_rating",
      "zoom_start_date": "collections_payload.zoom_start_date",
      "zoom_end_date": "collections_payload.zoom_end_date",
      "zoom_season": "collections_payload.zoom_season",
      "zoom_season_city_slug": "collections_payload.zoom_season_city_slug",
      "zoom_rating": "collections_payload.zoom_rating",
      "active_leg_count": "collections_payload.active_leg_count"
    },
    "collection_primary": {
      "path": "collections_payload.collection_primary",
      "fields": {
        "collection_uid": "collection_primary.collection_uid",
        "collection_title": "collection_primary.collection_title",
        "base_key": "collection_primary.base_key",
        "span_start_date": "collection_primary.span_start_date",
        "span_end_date": "collection_primary.span_end_date",
        "span_season": "collection_primary.span_season",
        "span_season_city_slug": "collection_primary.span_season_city_slug",
        "span_rating": "collection_primary.span_rating",
        "zoom_leg_index": "collection_primary.zoom_leg_index",
        "zoom_leg_key": "collection_primary.zoom_leg_key",
        "zoom_leg_name": "collection_primary.zoom_leg_name",
        "zoom_season": "collection_primary.zoom_season",
        "zoom_start_date": "collection_primary.zoom_start_date",
        "zoom_end_date": "collection_primary.zoom_end_date",
        "zoom_season_city_slug": "collection_primary.zoom_season_city_slug",
        "zoom_rating": "collection_primary.zoom_rating",
        "role": "collection_primary.role",
        "rank": "collection_primary.rank"
      },
      "comps_array_path": "collection_primary.comps",
      "comps_shape": {
        "comp_uuid": "comp_uuid",
        "comp_id": "comp_id",
        "venue_uid": "venue_uid",
        "base_name": "base_name",
        "comp_name": "comp_name",
        "city": "city",
        "state": "state",
        "zone": "zone",
        "start_date": "start_date",
        "end_date": "end_date",
        "base_key": "base_key",
        "leg_key": "leg_key",
        "leg_uuid": "leg_uuid"
      }
    }
  },
  "blueprint": {
    "block_order": [
      "event",
      "venue",
      "host_city",
      "hello",
      "seo"
    ],
    "brand_profile": {
      "audience": "Time-poor competitive hunter/jumper riders, trainers, and supporter families.",
      "voice": "Straightforward, magazine-style English. Confident and informed, never slangy or over-hyped.",
      "pov": "Primarily third-person editorial. Optional light first-person from the CRT founder in the main outro only.",
      "brand_name_rules": [
        "Spell the brand as 'Clear Round Travel (CRT)' on first mention in the outro, then 'CRT' only.",
        "Never invent variants like 'CIRT' or other misspellings."
      ]
    },
    "copy_principles": {
      "no_typos_or_neologisms": "Do not invent new words or unusual spellings. No 'ryders', 'Regonal', 'ballanced', or similar.",
      "grammar": "Use standard written English. Avoid fragments unless clearly intentional and rare.",
      "clarity_over_style": "If a phrase sounds odd or unclear, prefer a simple, literal alternative.",
      "metaphors": "At most one light, familiar image per paragraph; avoid mixed or surreal metaphors.",
      "geography": "Do not assume beaches, mountains, snow, or desert unless clearly implied by inputs. Use generic but plausible visuals when uncertain.",
      "no_filler": "Avoid empty phrases like 'classic travel environment' or 'journal of elegance'. Say what is actually happening or visible.",
      "ascii_only": "Free-text fields must be ASCII only."
    },
    "event_block": {
      "goal": "Event-only prestige copy centered on identity, reputation, and rider caliber, derived strictly from the collections_payload.",
      "fields": [
        "name",
        "official_link",
        "start_date",
        "end_date",
        "rating_tags",
        "rider_caliber",
        "aliases",
        "known_for",
        "vibe",
        "event_paragraph",
        "event_hello_sentence"
      ],
      "inputs_from_payload": {
        "event_name": "collection_primary.collection_title",
        "event_series_key": "collection_primary.base_key",
        "event_span_start_date": "span_start_date",
        "event_span_end_date": "span_end_date",
        "event_rating_raw": "span_rating",
        "event_city": "first(collection_primary.comps).city",
        "event_state": "first(collection_primary.comps).state",
        "event_zone": "first(collection_primary.comps).zone",
        "event_official_link": "optional, may be null or absent",
        "event_aliases_hint": "optional, may be derived from comp_name values (e.g., ESP Summer II, ESP Summer III)"
      },
      "rules": {
        "source": "Use only the collections_payload and allowed_extra proper nouns. Do not fetch or invent external facts.",
        "name": "By default, use event_name exactly. You may append the word 'Series' only if clearly implied by event_name; otherwise keep it exact.",
        "dates": "Set start_date to event_span_start_date and end_date to event_span_end_date without changing formats.",
        "rating_tags": "Split event_rating_raw on commas and trim whitespace to form rating_tags. Example: 'Hunter(National),Jumper(4),H/J Channel: 1' → ['Hunter(National)', 'Jumper(4)', 'H/J Channel: 1'].",
        "official_link": "If event_official_link is not present or empty, set official_link to null. Do not invent URLs.",
        "aliases": "Use up to two short aliases based only on event_name, event_series_key, and comp_name values. Do not invent entirely new event titles.",
        "rider_caliber": "Choose ONE from: 'Local', 'Regional', 'National', 'International', 'Elite', 'World-Class', 'Olympic-caliber'. Infer the strongest realistic term from rating_tags and event_zone; do not exaggerate.",
        "known_for": "One concise clause of what the event is known for, grounded in event_name, rating_tags, and zone.",
        "vibe": "One short clause capturing the prestige or tone of the series (e.g., 'steady summer series with polished but approachable atmosphere').",
        "no_logistics": "Do not mention barns, stabling, stalls, haul-in, prize lists, daily schedules, or hospitality.",
        "no_city_copy": "Keep city language minimal; full city feel belongs in host_city.",
        "event_paragraph_length": "event_paragraph must be 80–130 words; single paragraph; describe identity, level, and why riders care.",
        "event_hello_sentence_max_words": 25,
        "wording": "No greetings in event_hello_sentence; it should be a clean clause that could stand in front of the paragraph."
      }
    },
    "venue_block": {
      "goal": "Venue-only copy on setting, layout, architecture, atmosphere, and reputation.",
      "fields": [
        "name",
        "official_link",
        "place_id",
        "city_state",
        "venue_acronyms",
        "venue_aliases",
        "venue_snap",
        "venue_paragraph",
        "venue_hello_sentence"
      ],
      "inputs_from_payload": {
        "venue_uid": "first(collection_primary.comps).venue_uid",
        "venue_city": "first(collection_primary.comps).city",
        "venue_state": "first(collection_primary.comps).state"
      },
      "rules": {
        "naming": "Derive the canonical venue name from venue_uid and allowed_extra proper nouns (for example, 'wef-wellington' → 'Wellington International' / 'WEF'). When uncertain, prefer a known allowed_extra name over inventing a new one. If nothing is clear, leave name empty rather than hallucinating.",
        "official_link": "If a curated official_link exists for this venue_uid in payload or allowed config, use it; otherwise set null.",
        "place_id": "If a curated place_id exists, use it; otherwise set null. Do not invent IDs.",
        "city_state": "Use normalized 'City, ST' from venue_city and venue_state.",
        "venue_acronyms": "Use farm_acronym or known allowed_extra acronyms (e.g. 'WEF', 'WEC'). If none apply, use an empty string.",
        "venue_aliases": "Short CSV of any known official aliases; otherwise empty string.",
        "no_events": "Do not mention specific shows, weeks, or dates in the venue block.",
        "no_city_copy": "Do not drift into off-site restaurants, neighborhoods, or beaches.",
        "venue_snap_length": "18–30 words; one strong line on how the venue looks and feels.",
        "venue_paragraph_length": "70–120 words; focus on arenas, footing, concourses, sightlines, and general atmosphere.",
        "venue_hello_sentence_max_words": 25,
        "tone": "Straight, descriptive, and grounded; no hype or slogans."
      }
    },
    "city_in_season_block": {
      "goal": "Host-city overlay for the primary season drawn from span_season or zoom_season.",
      "fields": [
        "city",
        "state",
        "season",
        "snapshot",
        "paragraph_80w",
        "hello_intro_sentence"
      ],
      "inputs_from_payload": {
        "city": "first(collection_primary.comps).city",
        "state": "first(collection_primary.comps).state",
        "season": "span_season or zoom_season when present"
      },
      "rules": {
        "city_only": "No venue names, show names, barns, rings, or specific competitions.",
        "no_events": "Do not reference classes, divisions, or rings.",
        "no_weather_numbers": "Describe feel (warm, crisp, humid) without temperatures or degree symbols.",
        "logistics_cues": "At most two short cues per paragraph (traffic pace, errand timing, mornings vs evenings).",
        "snapshot_words": {
          "min": 18,
          "max": 30
        },
        "paragraph_words": {
          "min": 60,
          "max": 90
        },
        "hello_intro_sentence_max_words": 25,
        "variation": {
          "no_greetings": true,
          "rotate_sensory_axis": true,
          "avoid_repeated_phrases": true
        }
      }
    },
    "hello_block": {
      "goal": "Create a vivid, competition-first top section that weaves together event, venue, and host city, using only facts already established in the other blocks and meta.",
      "structure": "hello.intro → hello.transition → hello.outro_pivot → hello.outro_main; each builds on the last without repeating the same claim.",
      "length_targets": {
        "intro_words": {
          "min": 120,
          "max": 180
        },
        "transition_words": {
          "min": 40,
          "max": 70
        },
        "outro_pivot_words": {
          "min": 35,
          "max": 70
        },
        "outro_main_words": {
          "min": 130,
          "max": 220
        }
      },
      "content_rules": {
        "intro_focus": [
          "Name and stature of the series or headline leg (from event block).",
          "High-level sense of rider caliber when supported by ratings or known history.",
          "One or two clean visuals about the venue setting and on-grounds feel (from venue block).",
          "A light nod to the host city in season, not full city copy."
        ],
        "transition_role": "Bridge from big-picture competition feel into planning blocks (stay, dine, locale, essentials); mention sleep, food, resets, and restock at a high level.",
        "outro_pivot_role": "Summarize how planning pieces fit together and pivot into a first-person logistics close.",
        "outro_main_role": "In first person as the CRT founder, explain how CRT handles hotels, meals, essentials, and timing so the week runs like a clear, controlled course.",
        "links": [
          "If event.official_link is available, link the first mention of the event name using markdown [Name](url).",
          "If venue.official_link is available, link the first mention of the venue name.",
          "Never invent URLs. If no link is available, leave the name unlinked."
        ],
        "forbid": [
          "No bullet lists, timetables, or step-by-step directions.",
          "No prices, tickets, box office language, or deep parking logistics.",
          "No copy/paste from event or venue websites; always paraphrase."
        ]
      }
    },
    "seo_block": {
      "goal": "Derive a small SEO bundle from event + venue + host_city.",
      "fields": [
        "section_title",
        "meta_description",
        "open_graph_title",
        "open_graph_description",
        "search_title",
        "search_description"
      ],
      "rules": {
        "section_title": "Short, human-readable H2-style title combining event and venue or city.",
        "meta_description": "One 18–28 word sentence summarizing the week for riders and families.",
        "open_graph_title": "Concise title combining event name and venue or city.",
        "open_graph_description": "20–32 word description highlighting competition identity and setting.",
        "search_title": "Search-friendly but natural title; no keyword stuffing.",
        "search_description": "Clean, one-sentence description; avoid repeating the same phrase more than twice.",
        "no_first_person": "SEO fields are neutral, not in 'I' voice.",
        "ascii_only": true
      }
    }
  },
  "output_schema": {
    "type": "object",
    "required": [
      "meta",
      "hello",
      "event",
      "venue",
      "host_city",
      "seo",
      "flags"
    ],
    "properties": {
      "meta": {
        "type": "object",
        "required": [
          "runner",
          "runner_version",
          "creation_id",
          "timestamp_iso",
          "blog_type"
        ],
        "properties": {
          "runner": {
            "type": "string",
            "const": "competition-runner"
          },
          "runner_version": {
            "type": "string"
          },
          "creation_id": {
            "type": "string"
          },
          "timestamp_iso": {
            "type": "string"
          },
          "blog_type": {
            "type": "string"
          }
        }
      },
      "hello": {
        "type": "object",
        "required": [
          "intro",
          "transition",
          "outro_pivot",
          "outro_main"
        ],
        "properties": {
          "intro": {
            "type": "string"
          },
          "transition": {
            "type": "string"
          },
          "outro_pivot": {
            "type": "string"
          },
          "outro_main": {
            "type": "string"
          }
        }
      },
      "event": {
        "type": "object",
        "required": [
          "name",
          "event_paragraph",
          "event_hello_sentence"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "official_link": {
            "type": [
              "string",
              "null"
            ]
          },
          "start_date": {
            "type": [
              "string",
              "null"
            ]
          },
          "end_date": {
            "type": [
              "string",
              "null"
            ]
          },
          "rating_tags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "rider_caliber": {
            "type": "string"
          },
          "aliases": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "known_for": {
            "type": "string"
          },
          "vibe": {
            "type": "string"
          },
          "event_paragraph": {
            "type": "string"
          },
          "event_hello_sentence": {
            "type": "string"
          }
        }
      },
      "venue": {
        "type": "object",
        "required": [
          "name",
          "venue_snap",
          "venue_paragraph",
          "venue_hello_sentence"
        ],
        "properties": {
          "name": {
            "type": "string"
          },
          "official_link": {
            "type": [
              "string",
              "null"
            ]
          },
          "place_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "city_state": {
            "type": [
              "string",
              "null"
            ]
          },
          "venue_acronyms": {
            "type": "string"
          },
          "venue_aliases": {
            "type": "string"
          },
          "venue_snap": {
            "type": "string"
          },
          "venue_paragraph": {
            "type": "string"
          },
          "venue_hello_sentence": {
            "type": "string"
          }
        }
      },
      "host_city": {
        "type": "object",
        "required": [
          "city",
          "state",
          "season",
          "snapshot",
          "paragraph_80w",
          "hello_intro_sentence"
        ],
        "properties": {
          "city": {
            "type": "string"
          },
          "state": {
            "type": "string"
          },
          "season": {
            "type": "string"
          },
          "snapshot": {
            "type": "string"
          },
          "paragraph_80w": {
            "type": "string"
          },
          "hello_intro_sentence": {
            "type": "string"
          }
        }
      },
      "seo": {
        "type": "object",
        "properties": {
          "section_title": {
            "type": "string"
          },
          "meta_description": {
            "type": "string"
          },
          "open_graph_title": {
            "type": "string"
          },
          "open_graph_description": {
            "type": "string"
          },
          "search_title": {
            "type": "string"
          },
          "search_description": {
            "type": "string"
          }
        }
      },
      "flags": {
        "type": "object",
        "properties": {
          "used_founder": {
            "type": "boolean"
          },
          "used_city_in_season_rules": {
            "type": "boolean"
          },
          "validation_passed": {
            "type": "boolean"
          },
          "validation_warnings": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    }
  },
  "validation": {
    "word_targets": {
      "hello_intro": {
        "min": 120,
        "max": 180
      },
      "hello_transition": {
        "min": 40,
        "max": 70
      },
      "hello_outro_pivot": {
        "min": 35,
        "max": 70
      },
      "hello_outro_main": {
        "min": 130,
        "max": 220
      },
      "city_snapshot": {
        "min": 18,
        "max": 30
      },
      "city_paragraph_80w": {
        "min": 60,
        "max": 90
      },
      "city_hello_intro_sentence": {
        "min": 1,
        "max": 25
      }
    },
    "guards": {
      "no_star_ratings_text": true,
      "no_ticketing_cta": true,
      "no_temperature_numbers": true,
      "no_directional_turn_by_turn": true
    }
  },
  "qa": {
    "config": {
      "path": "agents/competition-runner/qa-config.json",
      "optional": true,
      "usage": "If present, overrides or tightens these default QA rules. If missing, use qa.defaults."
    },
    "defaults": {
      "no_made_up_words": true,
      "no_obvious_misspellings": true,
      "no_fragment_sentences": true,
      "max_adjectives_per_sentence": 2,
      "sentence_words": {
        "min": 6,
        "max": 30
      },
      "proper_nouns": {
        "lock_to_payload": true,
        "allowed_extra": [
          "Clear Round Travel",
          "CRT",
          "Wellington",
          "Ocala",
          "World Equestrian Center",
          "WEC",
          "Wellington International",
          "Winter Equestrian Festival",
          "WEF",
          "ESP Summer",
          "ESP Summer Series"
        ]
      },
      "require_visual_detail": true
    },
    "apply_to_fields": [
      "hello.intro",
      "hello.transition",
      "hello.outro_pivot",
      "hello.outro_main",
      "event.event_paragraph",
      "event.event_hello_sentence",
      "venue.venue_snap",
      "venue.venue_paragraph",
      "venue.venue_hello_sentence",
      "host_city.snapshot",
      "host_city.paragraph_80w",
      "host_city.hello_intro_sentence",
      "seo.section_title",
      "seo.meta_description",
      "seo.open_graph_title",
      "seo.open_graph_description",
      "seo.search_title",
      "seo.search_description"
    ],
    "self_check_prompts": [
      "For each field listed in apply_to_fields, ensure there are no invented words or obvious misspellings.",
      "Ensure all event, venue, and city names match either the payload values or the allowed_extra list exactly.",
      "Check that each paragraph contains at least one concrete visual detail grounded in plausible show or city environments (arenas, footing, barns, palm-lined roads, warm evenings, etc.).",
      "If any sentence exceeds the configured sentence_words.max or feels grammatically broken, rewrite it once before finalizing."
    ]
  }
}
