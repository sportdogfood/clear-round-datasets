<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>USEF Results – 5550974 | Clear Round Travel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050509;
      --bg-alt: #0d0f16;
      --card-bg: #11141f;
      --card-border: #202538;
      --accent: #ffb03a;
      --accent-soft: rgba(255, 176, 58, 0.12);
      --text-main: #f8fafc;
      --text-muted: #9ca3af;
      --pill-bg: #111827;
      --pill-border: #1f2937;
      --shadow-soft: 0 18px 45px rgba(0, 0, 0, 0.55);
      --radius-xl: 18px;
      --radius-lg: 12px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 45%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px 16px 40px;
    }

    .page {
      max-width: 1120px;
      margin: 0 auto;
    }

    .page-header {
      margin-bottom: 18px;
    }

    .eyebrow {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 10px;
      border-radius: var(--radius-pill);
      background: radial-gradient(circle at left, #1f2937 0, #020617 70%);
      border: 1px solid rgba(148, 163, 184, 0.2);
    }

    .page-header h1 {
      margin-top: 10px;
      font-size: 26px;
      letter-spacing: 0.02em;
    }

    .page-header p {
      margin-top: 6px;
      font-size: 14px;
      color: var(--text-muted);
    }

    .summary-row {
      margin-top: 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      padding: 6px 11px;
      border-radius: var(--radius-pill);
      background: var(--pill-bg);
      border: 1px solid var(--pill-border);
      color: var(--text-muted);
      white-space: nowrap;
    }

    .pill strong {
      font-weight: 600;
      color: var(--text-main);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .meta-bar {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .meta-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 5px 9px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.9);
    }

    .meta-chip span.label {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 10px;
      color: #6b7280;
    }

    .meta-chip span.value {
      color: var(--text-main);
      font-size: 12px;
    }

    .competitions {
      margin-top: 26px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .comp-group {
      border-radius: var(--radius-xl);
      background: linear-gradient(
        135deg,
        rgba(15, 23, 42, 0.98),
        rgba(15, 23, 42, 0.92)
      );
      border: 1px solid rgba(31, 41, 55, 0.95);
      box-shadow: var(--shadow-soft);
      padding: 14px 14px 12px;
    }

    .comp-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .comp-title {
      font-size: 15px;
      font-weight: 600;
      line-height: 1.3;
    }

    .comp-meta-line {
      margin-top: 3px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .comp-meta-line span + span::before {
      content: "·";
      margin: 0 6px;
      color: #4b5563;
    }

    .comp-link {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--accent);
      text-decoration: none;
      padding: 4px 9px 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(251, 191, 36, 0.5);
      background: radial-gradient(circle at left, var(--accent-soft), transparent);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }

    .comp-link svg {
      width: 11px;
      height: 11px;
    }

    .class-strip {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 4px;
      scrollbar-width: thin;
      scrollbar-color: #4b5563 #020617;
    }

    .class-strip::-webkit-scrollbar {
      height: 6px;
    }

    .class-strip::-webkit-scrollbar-track {
      background: #020617;
    }

    .class-strip::-webkit-scrollbar-thumb {
      background: #4b5563;
      border-radius: 999px;
    }

    .class-card {
      min-width: 250px;
      max-width: 280px;
      background: radial-gradient(circle at top left, #111827 0, #020617 60%);
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      padding: 10px 11px 11px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .class-topline {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .class-code {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
    }

    .placing-pill {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: var(--radius-pill);
      background: rgba(22, 163, 74, 0.11);
      border: 1px solid rgba(22, 163, 74, 0.65);
      color: #bbf7d0;
      white-space: nowrap;
    }

    .placing-pill.dnp {
      background: rgba(55, 65, 81, 0.7);
      border-color: rgba(55, 65, 81, 0.9);
      color: #e5e7eb;
    }

    .class-name {
      font-size: 13px;
      font-weight: 500;
      margin-top: 2px;
    }

    .class-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .class-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .meta-tag {
      padding: 3px 7px;
      font-size: 11px;
      border-radius: var(--radius-pill);
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(31, 41, 55, 0.8);
      color: #d1d5db;
    }

    .meta-tag span.key {
      text-transform: uppercase;
      letter-spacing: 0.11em;
      font-size: 9px;
      color: #6b7280;
      margin-right: 3px;
    }

    .class-footer {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .flags {
      font-size: 10px;
      color: #fbbf24;
      max-width: 60%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .class-link {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--accent);
      text-decoration: none;
      padding: 3px 7px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(251, 191, 36, 0.4);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .empty {
      margin-top: 24px;
      font-size: 13px;
      color: var(--text-muted);
    }

    @media (max-width: 640px) {
      body {
        padding: 16px 12px 28px;
      }

      .page-header h1 {
        font-size: 22px;
      }

      .comp-group {
        padding: 12px;
      }

      .class-card {
        min-width: 230px;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <header class="page-header">
      <div class="eyebrow">
        <span class="pill-dot"></span>
        USEF Results Snapshot
      </div>
      <h1>USEF Person 5550974</h1>
      <p id="rider-line">Loading person metadata…</p>

      <div class="summary-row" id="summary-row"></div>

      <div class="meta-bar" id="meta-bar"></div>
    </header>

    <section id="competitions" class="competitions"></section>
    <p id="empty-msg" class="empty" style="display:none;">
      No results are available in this payload.
    </p>
  </main>

  <script>
    (async function () {
      const PERSON_ID = "5550974";
      const DATA_URL = `/data/usef/people/${PERSON_ID}.json`;

      const summaryRow = document.getElementById("summary-row");
      const metaBar = document.getElementById("meta-bar");
      const riderLine = document.getElementById("rider-line");
      const compsRoot = document.getElementById("competitions");
      const emptyMsg = document.getElementById("empty-msg");

      function safeText(v) {
        return v == null ? "" : String(v);
      }

      function firstNonEmpty(arr) {
        for (const v of arr) {
          if (v && String(v).trim() !== "") return v;
        }
        return "";
      }

      function normalizePlacing(placingRaw) {
        const txt = safeText(placingRaw).trim();
        if (!txt) return { label: "No placing", raw: txt, isDnp: true };
        const up = txt.toUpperCase();
        const isDnp = up.startsWith("DNP");
        // extract first token before comma (e.g. "3," or "1,")
        const first = txt.split(",")[0].trim();
        return {
          label: first || txt,
          raw: txt,
          isDnp,
        };
      }

      function parseYearFromRow(row) {
        const horseYear = safeText(row.HorseYear).trim();
        if (horseYear) return horseYear;

        const d = safeText(row.CompStartDate).trim(); // e.g. 11/7/2025
        const m = d.match(/(\d{4})$/);
        return m ? m[1] : "";
      }

      function createSummaryPill(label, value) {
        const pill = document.createElement("div");
        pill.className = "pill";
        const strong = document.createElement("strong");
        strong.textContent = value;
        pill.append(strong, document.createTextNode(" " + label));
        return pill;
      }

      function createMetaChip(label, value) {
        if (!value) return null;
        const chip = document.createElement("div");
        chip.className = "meta-chip";
        const spanLabel = document.createElement("span");
        spanLabel.className = "label";
        spanLabel.textContent = label;
        const spanValue = document.createElement("span");
        spanValue.className = "value";
        spanValue.textContent = value;
        chip.append(spanLabel, spanValue);
        return chip;
      }

      function buildDashboard(rows) {
        if (!rows || rows.length === 0) {
          riderLine.textContent = "No results found for this person ID.";
          emptyMsg.style.display = "block";
          return;
        }

        // Basic person metadata (same on every row)
        const sample = rows[0];
        const personId = safeText(sample.PersonID || PERSON_ID);
        const linkId = safeText(sample.LinkID);
        const location = safeText(sample.Location);
        const status = safeText(sample.USEFStatus);
        const memberships = safeText(sample.AffiliatedMemberships);

        const nameLine = [
          personId ? `Person ID ${personId}` : "",
          linkId ? `LinkID ${linkId}` : "",
        ]
          .filter(Boolean)
          .join(" · ");
        riderLine.textContent = nameLine || "USEF Person Summary";

        // Aggregates
        const compsById = new Map();
        const years = new Set();
        const horses = new Set();
        const sections = new Set();

        for (const row of rows) {
          const compId = safeText(row.CompID);
          if (!compsById.has(compId)) {
            compsById.set(compId, {
              CompID: compId,
              CompName: safeText(row.CompName),
              CompStartDate: safeText(row.CompStartDate),
              CompEndDate: safeText(row.CompEndDate),
              CompState: safeText(row.CompState),
              CompZone: safeText(row.CompZone),
              CompDisplayLink: safeText(row.CompDisplayLink),
              classes: [],
            });
          }
          const comp = compsById.get(compId);
          comp.classes.push(row);

          const yr = parseYearFromRow(row);
          if (yr) years.add(yr);

          const horseName = safeText(row.HorseName).trim();
          if (horseName) horses.add(horseName);

          const sectionName = safeText(row.SectionName).trim();
          if (sectionName) sections.add(sectionName);
        }

        const totalClasses = rows.length;
        const totalComps = compsById.size;
        const yearList = Array.from(years).sort();
        const horseCount = horses.size;

        // Summary pills
        summaryRow.innerHTML = "";
        summaryRow.appendChild(
          createSummaryPill("classes ridden", totalClasses)
        );
        summaryRow.appendChild(
          createSummaryPill("rated competitions", totalComps)
        );
        if (horseCount > 0) {
          summaryRow.appendChild(
            createSummaryPill(
              horseCount === 1 ? "horse in this payload" : "horses in this payload",
              horseCount
            )
          );
        }
        if (yearList.length > 0) {
          summaryRow.appendChild(
            createSummaryPill(
              yearList.length === 1 ? "season" : "seasons",
              yearList.join(", ")
            )
          );
        }

        // Meta bar
        metaBar.innerHTML = "";
        const chips = [];
        chips.push(
          createMetaChip("Location", location),
          createMetaChip("USEF Status", status),
          createMetaChip("Affiliations", memberships),
          createMetaChip("Zones", Array.from(
            new Set(rows.map(r => safeText(r.CompZone).trim()).filter(Boolean))
          ).join(", "))
        );
        chips
          .filter(Boolean)
          .forEach(ch => metaBar.appendChild(ch));

        // Competitions & class cards
        compsRoot.innerHTML = "";
        emptyMsg.style.display = "none";

        const sortedComps = Array.from(compsById.values()).sort((a, b) => {
          // sort by CompStartDate descending (most recent first) if possible
          const aY = parseYearFromRow(a.classes[0]) || "";
          const bY = parseYearFromRow(b.classes[0]) || "";
          if (aY && bY && aY !== bY) return bY.localeCompare(aY);

          const ad = a.CompStartDate;
          const bd = b.CompStartDate;
          return bd.localeCompare(ad);
        });

        for (const comp of sortedComps) {
          const compGroup = document.createElement("article");
          compGroup.className = "comp-group";

          const header = document.createElement("div");
          header.className = "comp-header";

          const left = document.createElement("div");

          const title = document.createElement("div");
          title.className = "comp-title";
          title.textContent = comp.CompName || `Competition ${comp.CompID}`;
          left.appendChild(title);

          const metaLine = document.createElement("div");
          metaLine.className = "comp-meta-line";

          const spanDate = document.createElement("span");
          spanDate.textContent = comp.CompStartDate && comp.CompEndDate
            ? `${comp.CompStartDate} – ${comp.CompEndDate}`
            : comp.CompStartDate || "";
          const spanLoc = document.createElement("span");
          const parts = [];
          if (comp.CompState) parts.push(comp.CompState);
          if (comp.CompZone) parts.push(`Zone ${comp.CompZone}`);
          spanLoc.textContent = parts.join(" ");

          if (spanDate.textContent) metaLine.appendChild(spanDate);
          if (spanLoc.textContent) metaLine.appendChild(spanLoc);
          if (metaLine.childNodes.length > 0) left.appendChild(metaLine);

          header.appendChild(left);

          if (comp.CompDisplayLink) {
            const link = document.createElement("a");
            link.className = "comp-link";
            link.href = comp.CompDisplayLink;
            link.target = "_blank";
            link.rel = "noopener noreferrer";
            link.innerHTML =
              'USEF DETAIL <svg viewBox="0 0 20 20" aria-hidden="true"><path fill="currentColor" d="M6.5 4h9a.5.5 0 0 1 .5.5v9a1 1 0 0 1-2 0V7.707L5.854 15.854a.5.5 0 0 1-.708-.708L13.293 7H6.5a1 1 0 0 1 0-2z"/></svg>';
            header.appendChild(link);
          }

          compGroup.appendChild(header);

          const strip = document.createElement("div");
          strip.className = "class-strip";

          const classesSorted = comp.classes.slice().sort((a, b) => {
            // primary: SectionName, secondary: placing position (better placing earlier)
            const sA = safeText(a.SectionName).toLowerCase();
            const sB = safeText(b.SectionName).toLowerCase();
            if (sA !== sB) return sA.localeCompare(sB);

            const pA = normalizePlacing(a.Placing);
            const pB = normalizePlacing(b.Placing);

            const numA = parseInt(pA.label, 10);
            const numB = parseInt(pB.label, 10);
            if (!Number.isNaN(numA) && !Number.isNaN(numB)) {
              return numA - numB;
            }
            return pA.label.localeCompare(pB.label);
          });

          for (const row of classesSorted) {
            const card = document.createElement("div");
            card.className = "class-card";

            const topline = document.createElement("div");
            topline.className = "class-topline";

            const code = document.createElement("div");
            code.className = "class-code";
            const secName = safeText(row.SectionName);
            code.textContent = secName || `Section ${safeText(row.SectionID)}`;
            topline.appendChild(code);

            const placingInfo = normalizePlacing(row.Placing);
            const placing = document.createElement("div");
            placing.className = "placing-pill" + (placingInfo.isDnp ? " dnp" : "");
            placing.textContent = placingInfo.label || "No placing listed";
            topline.appendChild(placing);

            card.appendChild(topline);

            const className = document.createElement("div");
            className.className = "class-name";
            className.textContent =
              safeText(row.ClassNumber) && safeText(row.ClassName)
                ? `${row.ClassNumber} – ${row.ClassName}`
                : safeText(row.ClassName) || `Class ${safeText(row.ClassNumber)}`;
            card.appendChild(className);

            const sub = document.createElement("div");
            sub.className = "class-sub";
            const horse = safeText(row.HorseName).trim();
            const backNo = safeText(row.BackNumber).trim();
            const details = [];
            if (horse) details.push(horse);
            if (backNo) details.push(`#${backNo}`);
            sub.textContent = details.join(" · ");
            card.appendChild(sub);

            const metaRow = document.createElement("div");
            metaRow.className = "class-meta-row";

            const entries = safeText(row.Entries).trim();
            if (entries) {
              const tag = document.createElement("div");
              tag.className = "meta-tag";
              tag.innerHTML =
                '<span class="key">Entries</span>' +
                `<span class="val">${entries}</span>`;
              metaRow.appendChild(tag);
            }

            const hunterMoney = safeText(row.HunterMoney).trim();
            const jumperMoney = safeText(row.JumperMoney).trim();
            const moneyVal = hunterMoney || jumperMoney;
            if (moneyVal) {
              const tag = document.createElement("div");
              tag.className = "meta-tag";
              tag.innerHTML =
                '<span class="key">Money</span>' +
                `<span class="val">$${moneyVal}</span>`;
              metaRow.appendChild(tag);
            }

            const yr = parseYearFromRow(row);
            if (yr) {
              const tag = document.createElement("div");
              tag.className = "meta-tag";
              tag.innerHTML =
                '<span class="key">Year</span>' +
                `<span class="val">${yr}</span>`;
              metaRow.appendChild(tag);
            }

            if (metaRow.childNodes.length > 0) card.appendChild(metaRow);

            const footer = document.createElement("div");
            footer.className = "class-footer";

            const flags = safeText(row.Flags).trim();
            const flagsEl = document.createElement("div");
            flagsEl.className = "flags";
            if (flags) {
              flagsEl.textContent = flags;
            } else {
              flagsEl.textContent = placingInfo.raw || "";
            }
            footer.appendChild(flagsEl);

            const classUrl = safeText(row.ClassURL);
            if (classUrl) {
              const link = document.createElement("a");
              link.className = "class-link";
              link.href = classUrl;
              link.target = "_blank";
              link.rel = "noopener noreferrer";
              link.textContent = "USEF CLASS";
              footer.appendChild(link);
            }

            card.appendChild(footer);
            strip.appendChild(card);
          }

          compGroup.appendChild(strip);
          compsRoot.appendChild(compGroup);
        }
      }

      try {
        const resp = await fetch(DATA_URL, { cache: "no-store" });
        if (!resp.ok) {
          riderLine.textContent = `Unable to load JSON (${resp.status}).`;
          emptyMsg.style.display = "block";
          return;
        }
        const data = await resp.json();
        buildDashboard(Array.isArray(data) ? data : []);
      } catch (err) {
        console.error("Failed to load USEF JSON", err);
        riderLine.textContent = "Error loading data.";
        emptyMsg.style.display = "block";
      }
    })();
  </script>
</body>
</html>
